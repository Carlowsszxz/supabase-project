<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="UMak_Logo_Registered.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <title>University of Makati Library - Login</title>
  <script>
    (function () {
      var originalWarn = console.warn;
      console.warn = function () {
        try {
          if (arguments && typeof arguments[0] === 'string' && arguments[0].indexOf('cdn.tailwindcss.com should not be used in production') !== -1) {
            return; // suppress only Tailwind CDN production warning
          }
        } catch (e) { }
        return originalWarn.apply(console, arguments);
      };
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="theme.css" />
  <style>
    .fade-content {
      opacity: var(--fade-initial-opacity, 0);
      will-change: opacity, filter;
      transition: opacity var(--fade-duration, 1000ms) var(--fade-easing, ease-out),
        filter var(--fade-duration, 1000ms) var(--fade-easing, ease-out);
    }

    .fade-content.is-visible {
      opacity: 1;
      filter: none;
    }

    /* Global fade-in system (copied from Frame 15) */
    [data-fade] {
      opacity: 0;
      --fade-init: 14px;
      --fade-filter: none;
      filter: var(--fade-filter) !important;
      transition: var(--fade-transition, opacity 1000ms ease-out, filter 1000ms ease-out) !important;
      will-change: opacity, filter;
    }

    [data-fade]:not([data-blur="false"]) {
      --fade-filter: blur(var(--fade-init));
    }

    /* Library-themed cursor follower - subtle and calm */
    .cursor-follower {
      position: fixed;
      top: 0;
      left: 0;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      pointer-events: none;
      transform: translate(-50%, -50%) scale(1);
      transition: opacity 200ms ease-out;
      will-change: transform, opacity;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      background: radial-gradient(circle, rgba(0, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0.05) 50%, rgba(0, 0, 0, 0.02) 100%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      opacity: 0;
      z-index: 1;
      /* Behind text and UI elements */
    }

    /* Dark mode - keep white cursor follower */
    @media (prefers-color-scheme: dark) {
      .cursor-follower {
        background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }
    }

    /* Manual dark mode class support */
    .dark .cursor-follower {
      background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    /* Hide on small screens and touch devices */
    @media (max-width: 640px) {
      .cursor-follower {
        display: none;
      }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .cursor-follower {
        display: none !important;
      }
    }

    /* Paper-textured background with subtle parallax - now transparent to show library background */
    .paper-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 120%;
      height: 120%;
      background-color: transparent;
      /* Changed from #f9f9f9 to transparent */
      background-image:
        radial-gradient(circle at 1px 1px, rgba(0, 0, 0, 0.02) 1px, transparent 0),
        linear-gradient(45deg, rgba(0, 0, 0, 0.01) 25%, transparent 25%, transparent 75%, rgba(0, 0, 0, 0.01) 75%),
        linear-gradient(-45deg, rgba(0, 0, 0, 0.01) 25%, transparent 25%, transparent 75%, rgba(0, 0, 0, 0.01) 75%);
      background-size: 20px 20px, 40px 40px, 40px 40px;
      background-position: 0 0, 0 0, 20px 20px;
      pointer-events: none;
      z-index: -1;
      will-change: transform;
      transition: transform 0.1s ease-out;
    }

    /* Disable parallax on mobile and touch devices */
    @media (max-width: 768px) {
      .paper-background {
        transform: none !important;
        width: 100%;
        height: 100%;
      }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .paper-background {
        transform: none !important;
      }
    }

    /* Library background with blur effect */
    .library-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #f0f0f0;
      /* Fallback color in case image doesn't load */
      background-image: url('librarybg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(6px);
      -webkit-filter: blur(6px);
      transform: scale(1.05);
      /* Slightly larger to hide blur edges */
      pointer-events: none;
      opacity: 0.7;
      /* Make background darker by reducing opacity */
      z-index: -2;
    }

    /* Dark mode support for library background */
    @media (prefers-color-scheme: dark) {
      .library-background {
        filter: blur(6px) brightness(0.7);
        -webkit-filter: blur(6px) brightness(0.7);
      }
    }

    /* Manual dark mode class support */
    .dark .library-background {
      filter: blur(6px) brightness(0.7);
      -webkit-filter: blur(6px) brightness(0.7);
    }

    /* Override theme.css body background to show library background */
    body {
      background-color: transparent !important;
      font-family: 'Inter', sans-serif !important;
    }

    /* Apply Inter font to all elements */
    * {
      font-family: 'Inter', sans-serif !important;
    }

    /* Enhanced footer with frosted glass effect */
    .footer-glass {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      color: #374151;
      font-weight: 500;
    }

    /* Dark mode footer */
    @media (prefers-color-scheme: dark) {
      .footer-glass {
        background: rgba(15, 23, 42, 0.85);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        color: #e5e7eb;
      }
    }

    /* Manual dark mode class support */
    .dark .footer-glass {
      background: rgba(15, 23, 42, 0.85);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      color: #e5e7eb;
    }

    /* Modern Top Navigation Bar */
    .modern-sidebar {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      min-width: 320px;
      max-width: 500px;
      height: auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-top: none;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
      z-index: 1000;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      padding: 1rem 2rem;
      gap: 1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Top Navigation Items */
    .sidebar-nav-item {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.3);
      color: #374151;
      text-decoration: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      will-change: transform, box-shadow, background;
    }

    .sidebar-nav-item:hover {
      transform: translateY(-2px) scale(1.05);
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(0, 0, 0, 0.5);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 0 20px rgba(59, 130, 246, 0.3);
    }

    .sidebar-nav-item:active {
      transform: translateY(0) scale(0.98);
    }

    .sidebar-nav-item.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
      color: #3b82f6;
    }

    /* Sidebar Icons */
    .sidebar-icon {
      width: 24px;
      height: 24px;
      stroke-width: 1.5;
    }

    /* Tooltips */
    .sidebar-tooltip {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      z-index: 1001;
    }

    .sidebar-tooltip::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-bottom-color: rgba(0, 0, 0, 0.9);
    }

    .sidebar-nav-item:hover .sidebar-tooltip {
      opacity: 1;
      visibility: visible;
    }

    /* Logo/Brand in Top Navigation */
    .sidebar-brand {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.5rem;
      margin-right: 1rem;
    }

    .sidebar-brand img {
      width: 40px;
      height: 40px;
      border-radius: 8px;
    }

    .sidebar-brand-text {
      font-size: 0.75rem;
      font-weight: 600;
      color: #374151;
      text-align: center;
      line-height: 1.2;
    }

    /* Burger Menu Button - Hidden on Desktop */
    .burger-menu-btn {
      display: none;
      position: fixed;
      top: 1.25rem;
      right: 1.25rem;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .burger-menu-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .burger-menu-btn:active {
      transform: scale(0.95);
    }

    .burger-line {
      width: 20px;
      height: 2px;
      background: #1e293b;
      border-radius: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (prefers-color-scheme: dark) {
      .burger-line {
        background: #e2e8f0;
      }
    }

    .dark .burger-line {
      background: #e2e8f0;
    }

    .burger-menu-btn.active .burger-line:nth-child(1) {
      transform: translateY(6px) rotate(45deg);
    }

    .burger-menu-btn.active .burger-line:nth-child(2) {
      opacity: 0;
      transform: translateX(20px);
    }

    .burger-menu-btn.active .burger-line:nth-child(3) {
      transform: translateY(-6px) rotate(-45deg);
    }

    /* Mobile Menu Overlay */
    .mobile-menu-overlay {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }

    .mobile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    /* Mobile Menu Panel */
    .mobile-menu-panel {
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 280px;
      max-width: 85vw;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-left: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: -8px 0 32px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transform: translateX(100%);
      visibility: hidden;
      pointer-events: none;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s;
      overflow-y: auto;
      padding: 5rem 1.5rem 2rem;
    }

    .mobile-menu-panel.active {
      transform: translateX(0);
      visibility: visible;
      pointer-events: auto;
    }

    .mobile-menu-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .mobile-menu-header img {
      width: 36px;
      height: 36px;
      border-radius: 8px;
    }

    .mobile-menu-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1e293b;
    }

    .mobile-nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #334155;
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .mobile-nav-item:hover {
      background: rgba(99, 102, 241, 0.15);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateX(-4px);
    }

    .mobile-nav-item.active {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
      color: #4f46e5;
    }

    .mobile-nav-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Dark Mode for Mobile Menu */
    @media (prefers-color-scheme: dark) {
      .burger-menu-btn {
        background: rgba(30, 41, 59, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      }

      .burger-menu-btn:hover {
        background: rgba(30, 41, 59, 1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      }

      .mobile-menu-panel {
        background: rgba(15, 23, 42, 0.95);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu-title {
        color: #e2e8f0;
      }

      .mobile-nav-item {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #cbd5e1;
      }

      .mobile-nav-item:hover {
        background: rgba(99, 102, 241, 0.2);
        border-color: rgba(99, 102, 241, 0.4);
      }

      .mobile-nav-item.active {
        background: rgba(99, 102, 241, 0.3);
        border-color: rgba(99, 102, 241, 0.5);
        color: #a5b4fc;
      }
    }

    .dark .burger-menu-btn {
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
    }

    .dark .burger-menu-btn:hover {
      background: rgba(30, 41, 59, 1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    }

    .dark .mobile-menu-panel {
      background: rgba(15, 23, 42, 0.95);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
    }

    .dark .mobile-menu-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .dark .mobile-menu-title {
      color: #e2e8f0;
    }

    .dark .mobile-nav-item {
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #cbd5e1;
    }

    .dark .mobile-nav-item:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
    }

    .dark .mobile-nav-item.active {
      background: rgba(99, 102, 241, 0.3);
      border-color: rgba(99, 102, 241, 0.5);
      color: #a5b4fc;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {

      /* Show burger menu button on mobile */
      .burger-menu-btn {
        display: flex;
      }

      .modern-sidebar {
        min-width: auto;
        padding: 0.75rem 1rem;
        gap: 0.75rem;
      }

      /* Hide navigation items on mobile, keep only logo */
      .sidebar-nav-item {
        display: none !important;
      }

      .sidebar-brand {
        border-right: none;
        margin-right: 0;
        padding-right: 0;
      }

      .sidebar-brand img {
        width: 32px;
        height: 32px;
      }

      .sidebar-brand-text {
        font-size: 0.625rem;
      }

      .sidebar-tooltip {
        display: none;
      }
    }

    /* Dark Mode Support */
    @media (prefers-color-scheme: dark) {
      .modern-sidebar {
        background: rgba(15, 23, 42, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-top: none;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
      }

      .sidebar-nav-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #e5e7eb;
      }

      .sidebar-nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.4);
      }

      .sidebar-nav-item.active {
        background: rgba(59, 130, 246, 0.3);
        border-color: rgba(59, 130, 246, 0.5);
        color: #60a5fa;
      }

      .sidebar-brand-text {
        color: #e5e7eb;
      }
    }

    /* Manual dark mode class support */
    .dark .modern-sidebar {
      background: rgba(15, 23, 42, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-top: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .dark .sidebar-nav-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e5e7eb;
    }

    .dark .sidebar-nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .dark .sidebar-nav-item.active {
      background: rgba(59, 130, 246, 0.3);
      border-color: rgba(59, 130, 246, 0.5);
      color: #60a5fa;
    }

    .dark .sidebar-brand-text {
      color: #e5e7eb;
    }

    /* Adjust main content for top navigation */
    .main-with-sidebar {
      margin-left: 0;
      padding-top: 100px;
      /* Add top padding to account for fixed top navigation */
    }

    @media (max-width: 768px) {
      .main-with-sidebar {
        padding-top: 80px;
        /* Smaller padding on mobile */
      }
    }
  </style>

  <script defer src="theme.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="config.js"></script>
  <script>
    // Language translations
    const translations = {
      en: {
        home: "Home",
        register: "Register",
        howToHelp: "How To / Help",
        settings: "Settings",
        loginTitle: "Welcome Back",
        loginSubtitle: "Sign in to your account to continue",
        emailLabel: "Email Address",
        passwordLabel: "Password",
        rememberMe: "Remember me",
        forgotPassword: "Forgot your password?",
        signIn: "Sign In",
        noAccount: "Don't have an account?",
        signUp: "Sign up here",
        librarySystem: "University of Makati Library",
        noiseComfort: "Noise Comfort Index"
      },
      fil: {
        home: "Mag-login",
        register: "Magparehistro",
        howToHelp: "Paano / Tulong",
        settings: "Mga Setting",
        loginTitle: "Maligayang Pagbabalik",
        loginSubtitle: "Mag-sign in sa inyong account upang magpatuloy",
        emailLabel: "Email Address",
        passwordLabel: "Password",
        rememberMe: "Tandaan ako",
        forgotPassword: "Nakalimutan ang password?",
        signIn: "Mag-sign In",
        noAccount: "Walang account?",
        signUp: "Mag-sign up dito",
        librarySystem: "Aklatan ng University of Makati",
        noiseComfort: "Index ng Kaginhawahan sa Ingay"
      }
    };

    // Function to update page language
    function updateLanguage(language) {
      const t = translations[language];
      if (!t) return;

      // Update all text elements
      const elements = {
        'home-tooltip': t.home,
        'register-tooltip': t.register,
        'help-tooltip': t.howToHelp,
        'settings-tooltip': t.settings,
        'login-title': t.loginTitle,
        'login-subtitle': t.loginSubtitle,
        'email-label': t.emailLabel,
        'password-label': t.passwordLabel,
        'remember-me': t.rememberMe,
        'forgot-password': t.forgotPassword,
        'sign-in-btn': t.signIn,
        'no-account': t.noAccount,
        'sign-up-link': t.signUp,
        'library-title': t.librarySystem,
        'footer-text': t.noiseComfort
      };

      // Update text content
      Object.entries(elements).forEach(([id, text]) => {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = text;
        }
      });
    }

    // Initialize Lucide icons
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }

      // Mobile Menu Toggle
      (function () {
        const burgerBtn = document.getElementById('burgerMenuBtn');
        const mobileOverlay = document.getElementById('mobileMenuOverlay');
        const mobilePanel = document.getElementById('mobileMenuPanel');

        if (!burgerBtn || !mobileOverlay || !mobilePanel) return;

        let isMenuOpen = false;

        function openMenu() {
          isMenuOpen = true;
          burgerBtn.classList.add('active');
          mobileOverlay.classList.add('active');
          mobilePanel.classList.add('active');
          document.documentElement.style.overflow = 'hidden';
        }

        function closeMenu() {
          isMenuOpen = false;
          burgerBtn.classList.remove('active');
          mobileOverlay.classList.remove('active');
          mobilePanel.classList.remove('active');
          document.documentElement.style.overflow = '';
        }

        function toggleMenu() {
          if (isMenuOpen) {
            closeMenu();
          } else {
            openMenu();
          }
        }

        burgerBtn.addEventListener('click', toggleMenu);
        mobileOverlay.addEventListener('click', closeMenu);

        const mobileNavItems = mobilePanel.querySelectorAll('.mobile-nav-item');
        mobileNavItems.forEach(item => {
          item.addEventListener('click', closeMenu);
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && isMenuOpen) {
            closeMenu();
          }
        });

        window.addEventListener('resize', () => {
          if (window.innerWidth > 768 && isMenuOpen) {
            closeMenu();
          }
        });

        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      })();

      // Load saved language and apply it
      const savedLanguage = localStorage.getItem('language');
      if (savedLanguage) {
        updateLanguage(savedLanguage);
      }
    });

    // Ensure Supabase is loaded before our script
    window.addEventListener('load', function () {
      if (typeof window.supabase === 'undefined') {
        console.error('Supabase library failed to load');
      } else {
        console.log('Supabase library loaded successfully');
      }
    });
  </script>
  <script src="supabase.js"></script>
  <script src="auth.js"></script>
  <script src="password-toggle.js"></script>
</head>

<body class="text-slate-900 min-h-screen flex flex-col relative">
  <div id="cursor-follower" class="cursor-follower" aria-hidden="true"></div>
  <div id="library-background" class="library-background" aria-hidden="true"></div>
  <div id="paper-background" class="paper-background" aria-hidden="true"></div>
  <!-- Modern Top Navigation Bar -->
  <nav class="modern-sidebar" data-fade data-blur="true" data-initial-opacity="0" data-duration="1000">
    <!-- Brand/Logo -->
    <div class="sidebar-brand">
      <img src="UMak_Logo_Registered.png" alt="University of Makati Logo" />
    </div>

    <!-- Navigation Items -->
    <a href="index.html" class="sidebar-nav-item active" aria-label="Home">
      <i data-lucide="home" class="sidebar-icon"></i>
      <div class="sidebar-tooltip" id="home-tooltip">Home</div>
    </a>

    <a href="Frame_5.html" class="sidebar-nav-item" aria-label="Register">
      <i data-lucide="user-plus" class="sidebar-icon"></i>
      <div class="sidebar-tooltip" id="register-tooltip">Register</div>
    </a>

    <a href="how-to.html" class="sidebar-nav-item" aria-label="How To / Help">
      <i data-lucide="help-circle" class="sidebar-icon"></i>
      <div class="sidebar-tooltip" id="help-tooltip">How To / Help</div>
    </a>

    <a href="Settings.html" class="sidebar-nav-item" aria-label="Settings">
      <i data-lucide="settings" class="sidebar-icon"></i>
      <div class="sidebar-tooltip" id="settings-tooltip">Settings</div>
    </a>
  </nav>

  <!-- Burger Menu Button (Mobile Only) -->
  <button class="burger-menu-btn" id="burgerMenuBtn" aria-label="Toggle menu">
    <span class="burger-line"></span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

  <!-- Mobile Menu Panel -->
  <div class="mobile-menu-panel" id="mobileMenuPanel">
    <div class="mobile-menu-header">
      <img src="UMak_Logo_Registered.png" alt="UMak Logo" />
      <div class="mobile-menu-title">Navigation</div>
    </div>

    <a href="index.html" class="mobile-nav-item active">
      <i data-lucide="home" class="mobile-nav-icon"></i>
      <span id="mobile-home-label">Home</span>
    </a>

    <a href="Frame_5.html" class="mobile-nav-item">
      <i data-lucide="user-plus" class="mobile-nav-icon"></i>
      <span id="mobile-register-label">Register</span>
    </a>

    <a href="how-to.html" class="mobile-nav-item">
      <i data-lucide="help-circle" class="mobile-nav-icon"></i>
      <span id="mobile-help-label">How To / Help</span>
    </a>

    <a href="Settings.html" class="mobile-nav-item">
      <i data-lucide="settings" class="mobile-nav-icon"></i>
      <span id="mobile-settings-label">Settings</span>
    </a>
  </div>

  <main class="main-with-sidebar flex-1 flex items-center justify-center py-12 px-6" data-fade data-blur="true"
    data-initial-opacity="0" data-duration="1000" data-delay="50">
    <div id="fade-content" class="w-full max-w-6xl fade-content" data-blur="true" data-duration="1000"
      data-easing="ease-out" data-initial-opacity="0">
      <div class="bg-white rounded-2xl shadow overflow-hidden">
        <div class="grid grid-cols-1 md:grid-cols-2">
          <!-- Left: Login form -->
          <div class="p-8">
            <h1 id="login-title" class="text-4xl font-bold mb-2">Welcome Back</h1>
            <p id="login-subtitle" class="text-sm text-slate-500 mb-6">Sign in to your account to continue</p>

            <!-- Status Messages -->
            <div id="login-error"
              class="mb-4 text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg p-3 hidden"></div>
            <div id="login-success"
              class="mb-4 text-sm text-green-600 bg-green-50 border border-green-100 rounded-lg p-3 hidden"></div>
            <div id="login-loading"
              class="mb-4 text-sm text-blue-600 bg-blue-50 border border-blue-100 rounded-lg p-3 hidden">
              <div class="flex items-center">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                Signing you in...
              </div>
            </div>

            <form id="login-form" class="space-y-4">
              <div>
                <label id="email-label" class="block text-sm font-medium text-slate-700 mb-1">Email Address</label>
                <input id="login-email" type="email"
                  class="w-full p-3 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition"
                  placeholder="your.email@umak.edu.ph" required />
              </div>

              <div>
                <label id="password-label" class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                <input id="login-password" type="password"
                  class="w-full p-3 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition"
                  placeholder="Enter your password" required />
              </div>

              <!-- Admin Code Section (Hidden by default) -->
              <div id="admin-secret" class="hidden">
                <label class="block text-sm font-medium text-slate-700 mb-1">Admin Code (Optional)</label>
                <input id="admin-code" type="password"
                  class="w-full p-3 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition"
                  placeholder="Enter admin code" />
                <p class="mt-1 text-xs text-slate-500">Press Alt+A or click the title 3 times to show/hide</p>
              </div>

              <div class="flex items-center justify-between">
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" class="rounded" />
                  <span id="remember-me">Remember me</span>
                </label>
                <a href="Frame_14.html" id="forgot-password"
                  class="text-sm text-indigo-600 hover:text-indigo-700">Forgot your password?</a>
              </div>

              <div>
                <button type="submit" id="sign-in-btn"
                  class="w-full py-3 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
                  Sign In
                </button>
              </div>
            </form>

            <div class="mt-6 text-center">
              <p class="text-sm text-slate-500">
                <span id="no-account">Don't have an account?</span>
                <a href="Frame_5.html" id="sign-up-link" class="text-indigo-600 hover:text-indigo-700 font-medium">Sign
                  up here</a>
              </p>
            </div>
          </div>

          <!-- Right: Dynamic wallpaper panel -->
          <div class="relative h-full min-h-[360px]">
            <!-- Wallpaper container with two layers for smooth crossfade -->
            <div id="wallpaper" class="absolute inset-0 overflow-hidden rounded-none md:rounded-l-2xl">
              <img class="wall-slide opacity-100" alt="Library wallpaper" />
              <img class="wall-slide opacity-0" alt="Library wallpaper" />
              <div class="absolute inset-0 bg-black/20"></div>
            </div>
            <!-- Optional overlay branding -->
            <div class="relative z-[1] h-full flex items-end justify-between p-6">
              <div class="text-white drop-shadow-md">
                <!-- Fixed white text for brand visibility across light/dark modes -->
                <h2 id="library-title" class="text-xl font-semibold !text-white dark:!text-white">University of Makati
                  Library</h2>
                <p id="footer-text" class="text-sm opacity-90">Noise Comfort Index</p>
              </div>
              <a href="how-to.html"
                class="howto-btn inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/15 border border-white/15 text-white text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 19.5A2.5 2.5 0 0 0 6.5 22H19" />
                  <path d="M20 12v6" />
                  <path d="M20 18l-8-5v-5l8 5" />
                  <path d="M4 4h16v6H4z" />
                </svg>
                How to use
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </main>


  <script>
    (function () {
      function initSquares() {
        var el = document.getElementById('squares-bg');
        if (!el || typeof window.createSquares !== 'function') return;
        window.createSquares(el, {
          speed: 0.5,
          squareSize: 40,
          direction: 'diagonal',
          borderColor: '#052865',
          hoverFillColor: '#222'
        });
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSquares);
      } else { initSquares(); }
    })();
  </script>
  <script>
    // Fade-on-scroll transitions (same behavior as Frame 15)
    (function () {
      var fadeElements = Array.from(document.querySelectorAll('[data-fade]'));
      if (fadeElements.length === 0) return;

      fadeElements.forEach(function (el) {
        var initialOpacity = parseFloat(el.getAttribute('data-initial-opacity') || '0');
        var duration = parseInt(el.getAttribute('data-duration') || '1000', 10);
        var easing = el.getAttribute('data-easing') || 'ease-out';
        var blurPxAttr = el.getAttribute('data-blur-px');
        var blurPx = parseInt(blurPxAttr || '14', 10);
        el.style.opacity = String(initialOpacity);
        el.style.setProperty('--fade-init', blurPx + 'px');
        el.style.setProperty('--fade-transition', 'opacity ' + duration + 'ms ' + easing + ', filter ' + duration + 'ms ' + easing);
      });

      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            var el = entry.target;
            var delay = parseInt(el.getAttribute('data-delay') || '0', 10);
            var blurAttr = el.getAttribute('data-blur');
            var blurEnabled = (blurAttr !== 'false');
            observer.unobserve(el);
            setTimeout(function () {
              el.style.opacity = '1';
              if (blurEnabled) {
                el.style.setProperty('--fade-init', '0px');
              }
            }, delay);
          }
        });
      }, { threshold: 0.1 });

      fadeElements.forEach(function (el) { observer.observe(el); });
    })();
  </script>
  <script>
    (function () {
      function initFadeContent() {
        var el = document.getElementById('fade-content');
        if (!el) return;
        var blur = el.getAttribute('data-blur') === 'true';
        var duration = parseInt(el.getAttribute('data-duration') || '1000', 10);
        var easing = el.getAttribute('data-easing') || 'ease-out';
        var initialOpacity = parseFloat(el.getAttribute('data-initial-opacity') || '0');

        // set CSS variables
        el.style.setProperty('--fade-duration', duration + 'ms');
        el.style.setProperty('--fade-easing', easing);
        el.style.setProperty('--fade-initial-opacity', String(initialOpacity));
        if (blur) el.style.filter = 'blur(6px)';

        var io = new IntersectionObserver(function (entries) {
          entries.forEach(function (entry) {
            if (entry.isIntersecting) {
              // remove inline blur then reveal
              try { el.style.filter = 'none'; } catch (_) { }
              el.classList.add('is-visible');
              if (io) io.disconnect();
            }
          });
        }, { threshold: 0.1 });
        io.observe(el);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFadeContent);
      } else {
        initFadeContent();
      }
    })();
  </script>



  <script>
    (function () {
      // Prevent auto-redirects when coming from a logout or when on registration page
      var skipAutoRedirect = false;
      // Initialize Supabase with retry mechanism
      let supabaseInitialized = false;

      async function initializeSupabase() {
        try {
          // Try immediate initialization first
          if (initSupabase()) {
            supabaseInitialized = true;
            console.log('Supabase initialized successfully');
            return;
          }

          // If immediate initialization fails, try with retry mechanism
          console.log('Immediate initialization failed, trying with retry...');
          supabaseInitialized = await initSupabaseWithRetry();

          if (supabaseInitialized) {
            console.log('Supabase initialized successfully with retry');
          } else {
            console.error('Supabase initialization failed after retries');
          }
        } catch (err) {
          console.error('Supabase error:', err);
        }
      }

      // Initialize Supabase
      initializeSupabase();

      // Constants
      let tapCount = 0;

      // UI Helper Functions
      function showError(message) {
        hideAllMessages();
        const el = document.getElementById('login-error');
        if (el) {
          el.textContent = message;
          el.classList.remove('hidden');
        }
      }

      function showSuccess(message) {
        hideAllMessages();
        const el = document.getElementById('login-success');
        if (el) {
          el.textContent = message;
          el.classList.remove('hidden');
        }
      }

      function showLoading() {
        hideAllMessages();
        const el = document.getElementById('login-loading');
        if (el) {
          el.classList.remove('hidden');
        }
      }

      function hideAllMessages() {
        const messages = ['login-error', 'login-success', 'login-loading'];
        messages.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.classList.add('hidden');
        });
      }

      function setFormEnabled(enabled) {
        const form = document.getElementById('login-form');
        const inputs = form.querySelectorAll('input, button');
        inputs.forEach(input => {
          input.disabled = !enabled;
        });
      }

      // Admin Code Toggle
      function toggleAdminSecret(force) {
        const wrap = document.getElementById('admin-secret');
        if (!wrap) return;
        const willShow = typeof force === 'boolean' ? force : wrap.classList.contains('hidden');
        if (willShow) {
          wrap.classList.remove('hidden');
        } else {
          wrap.classList.add('hidden');
        }
      }

      // Event Listeners for Admin Code
      const title = document.querySelector('.brand-title');
      if (title) {
        title.addEventListener('click', function () {
          tapCount++;
          if (tapCount >= 3) {
            toggleAdminSecret();
            tapCount = 0;
          }
          setTimeout(function () { tapCount = 0; }, 1200);
        });
      }

      document.addEventListener('keydown', function (e) {
        if ((e.altKey || e.metaKey) && (e.key === 'a' || e.key === 'A')) {
          toggleAdminSecret();
        }
      });

      // URL Parameter Handling
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get('message');
      const logoutFlag = urlParams.get('logout');
      if (logoutFlag) {
        skipAutoRedirect = true;
        try { window.supabaseAuth && window.supabaseAuth.signOut && window.supabaseAuth.signOut(); } catch (_) { }
        // Clean the URL so refreshes don't keep the flag
        window.history.replaceState({}, document.title, window.location.pathname);
      }
      if (message) {
        showSuccess(message);
        // Clear the URL parameter
        window.history.replaceState({}, document.title, window.location.pathname);
      }

      // Form Validation
      function validateForm() {
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        // Use AuthManager validation if available
        if (window.authManager) {
          const emailValidation = window.authManager.validateEmail(email);
          if (!emailValidation.valid) {
            showError(emailValidation.message);
            return false;
          }

          const passwordValidation = window.authManager.validatePassword(password);
          if (!passwordValidation.valid) {
            showError(passwordValidation.message);
            return false;
          }

          return true;
        }

        // Fallback validation
        if (!email) {
          showError('Email address is required');
          return false;
        }

        if (!email.toLowerCase().endsWith('@umak.edu.ph')) {
          showError('Please use a University of Makati email address (@umak.edu.ph)');
          return false;
        }

        if (!password) {
          showError('Password is required');
          return false;
        }

        return true;
      }

      // Enhanced User Profile Check
      async function checkAndCreateUserProfile(user) {
        if (!user || !user.id) {
          return false;
        }

        const email = (user.email || '').toLowerCase();
        if (!email.endsWith('@umak.edu.ph')) {
          return false;
        }

        try {
          // Check if user exists in users table
          const profileResult = await window.supabaseDB.getUser(user.id);

          if (profileResult.data) {
            console.log('User profile found:', profileResult.data);
            return true;
          } else {
            console.log('User profile not found, creating...');

            // Create user profile with metadata
            const userData = {
              first_name: user.user_metadata?.first_name || '',
              last_name: user.user_metadata?.last_name || '',
              student_id: user.user_metadata?.student_id || '',
              program: user.user_metadata?.program || ''
            };

            const createResult = await window.supabaseDB.insertUser(user.id, userData);

            if (createResult.error) {
              console.error('Failed to create user profile:', createResult.error);
              if (createResult.error.code === 'PGRST205') {
                console.error('Database table not found. Please run the SQL setup in Supabase dashboard.');
              }
              return false;
            } else {
              console.log('User profile created successfully:', createResult.data);
              return true;
            }
          }
        } catch (error) {
          console.error('Error checking/creating user profile:', error);
          return false;
        }
      }

      // Determine Destination After Login
      async function getDestinationAfterLogin(email, password, user) {
        try {
          // Use the secure AuthManager for destination determination
          if (window.authManager) {
            return await window.authManager.getDestinationAfterLogin(user);
          }

          // Fallback to default destination
          return 'Frame_11.html';
        } catch (error) {
          console.error('Error determining destination:', error);
          return 'Frame_11.html';
        }
      }

      // Login Handler
      async function handleLogin(event) {
        event.preventDefault();

        // Wait for Supabase to initialize if not ready
        if (!supabaseInitialized) {
          showError('System is initializing. Please wait a moment and try again.');

          // Try to initialize again
          await initializeSupabase();

          if (!supabaseInitialized) {
            showError('System not initialized. Please refresh the page and try again.');
            return;
          }
        }

        // Initialize AuthManager if not already done
        if (window.authManager && !window.authManager.isInitialized) {
          await window.authManager.initialize();
        }

        if (!validateForm()) {
          return;
        }

        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        try {
          showLoading();
          setFormEnabled(false);

          console.log('Attempting login with:', email);

          // Use secure AuthManager for login
          let result;
          if (window.authManager) {
            result = await window.authManager.login(email, password);
          } else {
            // Fallback to direct Supabase call
            result = await window.supabaseAuth.signIn(email, password);
            if (result.error) {
              throw result.error;
            }
          }

          console.log('Login successful:', result.data);

          // Check and create user profile
          const profileExists = await checkAndCreateUserProfile(result.data.user);

          if (!profileExists) {
            // Sign out the user if profile creation failed
            await window.supabaseAuth.signOut();
            showError('Account setup incomplete. Please try registering again.');
            return;
          }

          // Log login activity (best-effort)
          try {
            const userEmail = (result?.data?.user?.email) || null;
            const userId = (result?.data?.user?.id) || null;
            if (window.supabaseDB && userId) {
              window.supabaseDB.addActivityLog({
                userId: userId,
                userName: userEmail,
                type: 'login',
                title: 'User Login',
                description: (userEmail || 'A user') + ' logged in successfully',
                severity: 'success',
                details: null
              });
            }
          } catch (_) { }

          // Determine destination
          const destination = await getDestinationAfterLogin(email, password, result.data.user);

          showSuccess('Login successful! Redirecting...');

          // Redirect to appropriate page
          const redirectDelay = window.APP_CONFIG?.ui?.redirectDelay || 1000;
          setTimeout(() => {
            window.location.href = destination;
          }, redirectDelay);

        } catch (error) {
          console.error('Login error:', error);

          // Enhanced error handling
          if (error.message.includes('Invalid login credentials')) {
            showError('Invalid email or password. Please check your credentials and try again.');
          } else if (error.message.includes('Email not confirmed')) {
            showError('Please check your email and click the confirmation link before signing in.');
          } else if (error.message.includes('Too many requests') || error.message.includes('Too many login attempts')) {
            showError('Too many login attempts. Please wait a moment and try again.');
          } else if (error.message.includes('Please use a University of Makati email address')) {
            showError(error.message);
          } else if (error.message.includes('Password must be at least')) {
            showError(error.message);
          } else {
            showError(error.message || 'Login failed. Please try again.');
          }
        } finally {
          setFormEnabled(true);
        }
      }

      // Event Listeners
      const form = document.getElementById('login-form');
      if (form) {
        form.addEventListener('submit', handleLogin);
      }

      // Mobile menu toggle
      const mobileBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      if (mobileBtn && mobileMenu) {
        mobileBtn.addEventListener('click', function () {
          const isHidden = mobileMenu.classList.contains('hidden');
          if (isHidden) {
            mobileMenu.classList.remove('hidden');
            mobileBtn.setAttribute('aria-expanded', 'true');
          } else {
            mobileMenu.classList.add('hidden');
            mobileBtn.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // Real-time validation
      const emailInput = document.getElementById('login-email');
      if (emailInput) {
        emailInput.addEventListener('blur', function () {
          const email = this.value.trim();
          if (email) {
            if (window.authManager) {
              const validation = window.authManager.validateEmail(email);
              if (!validation.valid) {
                showError(validation.message);
              } else {
                hideAllMessages();
              }
            } else {
              // Fallback validation
              if (!email.toLowerCase().endsWith('@umak.edu.ph')) {
                showError('Please use a University of Makati email address (@umak.edu.ph)');
              } else {
                hideAllMessages();
              }
            }
          }
        });
      }

      // Check if user is already logged in
      // Removed auto-redirect logic to prevent interference with registration page access

    })();
  </script>
  <script>
    (function () {
      var container = document.getElementById('wallpaper');
      if (!container) return;
      var slides = container.querySelectorAll('.wall-slide');
      if (!slides || slides.length < 2) return;

      var files = ['library1.jpg', 'library2.jpg', 'library3.jpg'];
      var index = 0;
      var DURATION = 1500; // ~1.5s fade
      var INTERVAL = 2000; // 2s cycle

      // Preload to avoid flicker
      try { files.forEach(function (src) { var im = new Image(); im.src = src; }); } catch (_) { }

      // Ensure sizing and performance hints
      slides.forEach(function (img) {
        img.style.objectFit = 'cover';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.position = 'absolute';
        img.style.inset = '0';
        img.style.backfaceVisibility = 'hidden';
        img.style.willChange = 'opacity';
        img.setAttribute('aria-hidden', 'true');
      });

      function setSrc(img, i) { img.src = files[((i % files.length) + files.length) % files.length]; }
      // Initialize persistent front/back refs and states
      var front = slides[0];
      var back = slides[1];
      setSrc(front, 0);
      setSrc(back, 1);
      front.classList.remove('opacity-0');
      back.classList.add('opacity-0');

      var busy = false;
      function crossfade() {
        if (busy) return; // prevent overlap if timer fires early
        busy = true;
        var next = (index + 1) % files.length;
        // Prepare back layer with next image hidden
        setSrc(back, next);
        back.classList.add('opacity-0');

        // Double RAF to ensure transition triggers every cycle
        requestAnimationFrame(function () {
          requestAnimationFrame(function () {
            front.classList.add('opacity-0');
            back.classList.remove('opacity-0');
          });
        });

        // Swap refs after fade completes
        setTimeout(function () {
          var tmp = front; front = back; back = tmp;
          index = next;
          busy = false;
        }, DURATION + 50);
      }

      setInterval(crossfade, INTERVAL);
    })();
  </script>
  <style>
    /* Smooth, GPU-friendly crossfade for wallpapers (1.5s) */
    #wallpaper .wall-slide {
      transition: opacity 1500ms ease-in-out;
    }
  </style>
  <script>
    (function () {
      const follower = document.getElementById('cursor-follower');
      if (!follower) return;

      // Hide on touch devices
      const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
      if (isTouch) { follower.style.display = 'none'; return; }
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        follower.style.display = 'none'; return;
      }

      let mouseX = window.innerWidth / 2;
      let mouseY = window.innerHeight / 2;
      let posX = mouseX;
      let posY = mouseY;
      const ease = 0.08; // Slower, more gentle movement for library theme
      let isVisible = false;

      // Gentle fade in/out on mouse movement
      window.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        if (!isVisible) {
          follower.style.opacity = '0.6';
          isVisible = true;
        }
      }, { passive: true });

      // Fade out when mouse leaves window
      window.addEventListener('mouseleave', () => {
        follower.style.opacity = '0';
        isVisible = false;
      });

      // Smooth following animation
      function animate() {
        posX += (mouseX - posX) * ease;
        posY += (mouseY - posY) * ease;
        follower.style.transform = `translate(${posX}px, ${posY}px) translate(-50%, -50%)`;
        requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
    })();
  </script>
  <script>
    // Subtle parallax paper background effect
    (function () {
      const paperBg = document.getElementById('paper-background');
      if (!paperBg) return;

      // Hide parallax on touch devices and mobile
      const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
      const isMobile = window.innerWidth <= 768;
      if (isTouch || isMobile) {
        paperBg.style.display = 'none';
        return;
      }

      // Respect reduced motion preference
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        return;
      }

      let mouseX = window.innerWidth / 2;
      let mouseY = window.innerHeight / 2;
      let targetX = 0;
      let targetY = 0;
      const parallaxStrength = 0.02; // Very subtle movement
      const ease = 0.05; // Smooth following

      // Update mouse position
      window.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;

        // Calculate subtle offset (opposite direction for parallax effect)
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        targetX = (mouseX - centerX) * parallaxStrength;
        targetY = (mouseY - centerY) * parallaxStrength;
      }, { passive: true });

      // Smooth parallax animation
      function updateParallax() {
        const currentX = parseFloat(paperBg.style.transform.match(/translateX\(([^)]+)\)/) || [0, 0])[1] || 0;
        const currentY = parseFloat(paperBg.style.transform.match(/translateY\(([^)]+)\)/) || [0, 0])[1] || 0;

        const newX = currentX + (targetX - currentX) * ease;
        const newY = currentY + (targetY - currentY) * ease;

        paperBg.style.transform = `translate(${newX}px, ${newY}px)`;
        requestAnimationFrame(updateParallax);
      }

      requestAnimationFrame(updateParallax);
    })();
  </script>
</body>

</html>