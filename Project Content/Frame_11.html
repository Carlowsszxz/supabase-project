<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="UMak_Logo_Registered.png" />
  <title>University of Makati Library - User Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="theme.css" />
  <script defer src="theme.js"></script>

  <style>
    /* Collapsible Header - Glassmorphic Arrow Trigger */
    .header-trigger {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%) translateY(0);
      z-index: 99999;
      width: 70px;
      height: 36px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
      -webkit-backdrop-filter: blur(30px) saturate(180%);
      backdrop-filter: blur(30px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-top: none;
      border-radius: 0 0 20px 20px;
      border-top-left-radius: 0 !important;
      border-top-right-radius: 0 !important;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
        height 0.35s cubic-bezier(0.4, 0, 0.2, 1),
        background 0.35s ease,
        box-shadow 0.35s ease,
        border-color 0.35s ease;
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.15),
        0 8px 24px rgba(99, 102, 241, 0.12),
        0 4px 12px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      outline: none;
      animation: headerPulse 2s ease-in-out infinite;
    }

    .header-trigger:hover {
      height: 42px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
      -webkit-backdrop-filter: blur(40px) saturate(200%);
      backdrop-filter: blur(40px) saturate(200%);
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.25),
        0 10px 32px rgba(99, 102, 241, 0.18),
        0 6px 16px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
      border-color: rgba(255, 255, 255, 0.75);
    }

    .header-trigger:active {
      transform: translateX(-50%) translateY(0) scale(0.95);
    }

    .header-trigger.trigger-expanded:active {
      transform: translateX(-50%) translateY(75px) scale(0.95);
    }

    .header-trigger-icon {
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      color: #6366f1;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .header-trigger:hover .header-trigger-icon {
      color: #4f46e5;
      transform: translateY(3px) scale(1.1);
    }

    .header-trigger.header-expanded .header-trigger-icon {
      transform: rotate(180deg) scale(1.1);
      color: #4f46e5;
    }

    /* Pulse animation */
    @keyframes headerPulse {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.15),
          0 8px 24px rgba(99, 102, 241, 0.12),
          0 4px 12px rgba(0, 0, 0, 0.08),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      50% {
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.3),
          0 10px 28px rgba(99, 102, 241, 0.2),
          0 6px 16px rgba(0, 0, 0, 0.12),
          inset 0 1px 0 rgba(255, 255, 255, 0.35);
      }
    }

    .header-trigger.header-expanded {
      animation: none;
    }

    /* Arrow follows header - Smooth CSS transitions (matching index.html) */
    .header-trigger.trigger-collapsed {
      transform: translateX(-50%) translateY(0);
    }

    .header-trigger.trigger-expanded {
      transform: translateX(-50%) translateY(75px);
    }

    /* Nav Label (appears to left of nav container) */
    .nav-label {
      position: fixed;
      top: 22px;
      right: calc(50% + 210px);
      padding: 0.5rem 1rem;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      border-radius: 10px;
      font-size: 0.875rem;
      font-weight: 600;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      z-index: 99997;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .nav-label.visible {
      opacity: 1;
      visibility: visible;
    }

    /* Hide label on mobile */
    @media (max-width: 768px) {
      .nav-label {
        display: none;
      }
    }

    /* Modern Top Navigation Bar */
    .modern-sidebar {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      min-width: 320px;
      max-width: 500px;
      height: auto;
      background: rgba(255, 255, 255, 0.1);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-top: none;
      border-radius: 0 0 20px 20px;
      border-top-left-radius: 0 !important;
      border-top-right-radius: 0 !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
      z-index: 99998;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      padding: 1rem 2rem;
      gap: 1rem;
      transform-origin: top center;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
        opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1),
        filter 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      will-change: transform, opacity, filter;
      pointer-events: auto;
    }

    /* Collapsible Header States */
    .modern-sidebar.header-collapsed {
      transform: translateX(-50%) translateY(-120%);
      opacity: 0;
      filter: blur(10px);
      pointer-events: none;
    }

    .modern-sidebar.header-expanded {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
      filter: blur(0px);
      pointer-events: auto;
    }

    .modern-sidebar.animating-in {
      filter: blur(10px);
      animation: slideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .modern-sidebar.animating-out {
      filter: blur(10px);
      animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes slideDown {
      0% {
        transform: translateX(-50%) translateY(-120%);
        opacity: 0;
        filter: blur(10px);
      }

      100% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        filter: blur(0px);
      }
    }

    @keyframes slideUp {
      0% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        filter: blur(0px);
      }

      100% {
        transform: translateX(-50%) translateY(-120%);
        opacity: 0;
        filter: blur(10px);
      }
    }

    /* Hide trigger on mobile */
    @media (max-width: 768px) {
      .header-trigger {
        display: none;
      }

      .modern-sidebar.header-collapsed {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        pointer-events: auto;
      }
    }

    /* Top Navigation Items */
    .sidebar-nav-item {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.3);
      color: #374151;
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .sidebar-nav-item:hover {
      transform: translateY(-2px) scale(1.05);
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(0, 0, 0, 0.5);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 0 20px rgba(59, 130, 246, 0.3);
    }

    .sidebar-nav-item:active {
      transform: translateY(0) scale(0.98);
    }

    .sidebar-nav-item.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
      color: #3b82f6;
    }

    /* Sidebar Icons */
    .sidebar-icon {
      width: 24px;
      height: 24px;
      stroke-width: 1.5;
    }

    /* Tooltips */
    .sidebar-tooltip {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      z-index: 1001;
    }

    .sidebar-tooltip::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-bottom-color: rgba(0, 0, 0, 0.9);
    }

    .sidebar-nav-item:hover .sidebar-tooltip {
      opacity: 1;
      visibility: visible;
    }

    /* Logo/Brand in Top Navigation */
    .sidebar-brand {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.5rem;
    }

    .sidebar-brand img {
      width: 32px;
      height: 32px;
      border-radius: 6px;
    }

    .sidebar-brand-text {
      font-size: 1.125rem;
      font-weight: 600;
      color: #374151;
    }

    /* Burger Menu Button - Hidden on Desktop */
    .burger-menu-btn {
      display: none;
      position: fixed;
      top: 1.25rem;
      right: 1.25rem;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .burger-menu-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .burger-menu-btn:active {
      transform: scale(0.95);
    }

    .burger-line {
      width: 20px;
      height: 2px;
      background: #1e293b;
      border-radius: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (prefers-color-scheme: dark) {
      .burger-line {
        background: #e2e8f0;
      }
    }

    .dark .burger-line {
      background: #e2e8f0;
    }

    .burger-menu-btn.active .burger-line:nth-child(1) {
      transform: translateY(6px) rotate(45deg);
    }

    .burger-menu-btn.active .burger-line:nth-child(2) {
      opacity: 0;
      transform: translateX(20px);
    }

    .burger-menu-btn.active .burger-line:nth-child(3) {
      transform: translateY(-6px) rotate(-45deg);
    }

    /* Mobile Menu Overlay */
    .mobile-menu-overlay {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }

    .mobile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    /* Mobile Menu Panel */
    .mobile-menu-panel {
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 280px;
      max-width: 85vw;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-left: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: -8px 0 32px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transform: translateX(100%);
      visibility: hidden;
      pointer-events: none;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s;
      overflow-y: auto;
      padding: 5rem 1.5rem 2rem;
    }

    .mobile-menu-panel.active {
      transform: translateX(0);
      visibility: visible;
      pointer-events: auto;
    }

    .mobile-menu-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .mobile-menu-header img {
      width: 36px;
      height: 36px;
      border-radius: 8px;
    }

    .mobile-menu-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1e293b;
    }

    .mobile-nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #334155;
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .mobile-nav-item:hover {
      background: rgba(99, 102, 241, 0.15);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateX(-4px);
    }

    .mobile-nav-item.active {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
      color: #4f46e5;
    }

    .mobile-nav-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Dark Mode for Mobile Menu */
    @media (prefers-color-scheme: dark) {
      .burger-menu-btn {
        background: rgba(30, 41, 59, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      }

      .burger-menu-btn:hover {
        background: rgba(30, 41, 59, 1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      }

      .mobile-menu-panel {
        background: rgba(15, 23, 42, 0.95);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu-title {
        color: #e2e8f0;
      }

      .mobile-nav-item {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #cbd5e1;
      }

      .mobile-nav-item:hover {
        background: rgba(99, 102, 241, 0.2);
        border-color: rgba(99, 102, 241, 0.4);
      }

      .mobile-nav-item.active {
        background: rgba(99, 102, 241, 0.3);
        border-color: rgba(99, 102, 241, 0.5);
        color: #a5b4fc;
      }
    }

    .dark .burger-menu-btn {
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
    }

    .dark .burger-menu-btn:hover {
      background: rgba(30, 41, 59, 1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    }

    .dark .mobile-menu-panel {
      background: rgba(15, 23, 42, 0.95);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
    }

    .dark .mobile-menu-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .dark .mobile-menu-title {
      color: #e2e8f0;
    }

    .dark .mobile-nav-item {
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #cbd5e1;
    }

    .dark .mobile-nav-item:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
    }

    .dark .mobile-nav-item.active {
      background: rgba(99, 102, 241, 0.3);
      border-color: rgba(99, 102, 241, 0.5);
      color: #a5b4fc;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {

      /* Show burger menu button on mobile */
      .burger-menu-btn {
        display: flex;
      }

      .modern-sidebar {
        min-width: auto;
        padding: 0.75rem 1rem;
        gap: 0.75rem;
      }

      /* Hide navigation items on mobile, keep only logo */
      .sidebar-nav-item {
        display: none !important;
      }

      .sidebar-brand {
        border-right: none;
        margin-right: 0;
        padding-right: 0;
      }

      .sidebar-nav-item {
        width: 40px;
        height: 40px;
      }

      .sidebar-icon {
        width: 20px;
        height: 20px;
      }

      .sidebar-brand img {
        width: 28px;
        height: 28px;
      }

      .sidebar-brand-text {
        font-size: 1rem;
      }
    }

    /* Dark Mode Support */
    @media (prefers-color-scheme: dark) {
      .header-trigger {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(15, 23, 42, 0.2));
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.25),
          0 8px 24px rgba(0, 0, 0, 0.4),
          0 4px 12px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: headerPulseDark 2s ease-in-out infinite;
      }

      .header-trigger:hover {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.3));
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.35),
          0 10px 32px rgba(0, 0, 0, 0.5),
          0 6px 16px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.55);
      }

      .header-trigger.header-expanded {
        animation: none;
      }

      .header-trigger-icon {
        color: #818cf8;
      }

      .header-trigger:hover .header-trigger-icon {
        color: #a5b4fc;
      }

      @keyframes headerPulseDark {

        0%,
        100% {
          box-shadow: 0 0 20px rgba(99, 102, 241, 0.25),
            0 8px 24px rgba(0, 0, 0, 0.4),
            0 4px 12px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        50% {
          box-shadow: 0 0 35px rgba(99, 102, 241, 0.4),
            0 10px 28px rgba(0, 0, 0, 0.5),
            0 6px 16px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
      }

      .modern-sidebar {
        background: rgba(15, 23, 42, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-top: none;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
      }

      .sidebar-nav-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #e5e7eb;
      }

      .sidebar-nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.4);
      }

      .sidebar-nav-item.active {
        background: rgba(59, 130, 246, 0.3);
        border-color: rgba(59, 130, 246, 0.5);
        color: #60a5fa;
      }

      .sidebar-brand-text {
        color: #e5e7eb;
      }
    }

    /* Manual dark mode class support */
    .dark .header-trigger {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(15, 23, 42, 0.2));
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.25),
        0 8px 24px rgba(0, 0, 0, 0.4),
        0 4px 12px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      animation: headerPulseDark 2s ease-in-out infinite;
    }

    .dark .header-trigger:hover {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.3));
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.35),
        0 10px 32px rgba(0, 0, 0, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.55);
    }

    .dark .header-trigger.header-expanded {
      animation: none;
    }

    .dark .header-trigger-icon {
      color: #818cf8;
    }

    .dark .header-trigger:hover .header-trigger-icon {
      color: #a5b4fc;
    }

    .dark .modern-sidebar {
      background: rgba(15, 23, 42, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-top: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .dark .sidebar-nav-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e5e7eb;
    }

    .dark .sidebar-nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .dark .sidebar-nav-item.active {
      background: rgba(59, 130, 246, 0.3);
      border-color: rgba(59, 130, 246, 0.5);
      color: #60a5fa;
    }


    .dark .sidebar-brand-text {
      color: #e5e7eb;
    }

    /* Floating Library Info Button */
    .library-info-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 2px solid rgba(59, 130, 246, 0.3);
      box-shadow: 0 8px 32px rgba(59, 130, 246, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #3b82f6;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 999;
      outline: none;
    }

    .library-info-btn:hover {
      transform: scale(1.1) translateY(-4px);
      box-shadow: 0 12px 40px rgba(59, 130, 246, 0.35), 0 0 0 1px rgba(59, 130, 246, 0.3);
      border-color: rgba(59, 130, 246, 0.5);
      background: rgba(255, 255, 255, 1);
    }

    .library-info-btn:active {
      transform: scale(1.05);
    }

    /* Library Info Card */
    .library-info-card {
      position: fixed;
      bottom: 6rem;
      right: 2rem;
      min-width: 320px;
      max-width: 360px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.3);
      opacity: 0;
      visibility: hidden;
      transform: translateY(20px) scale(0.95);
      transform-origin: bottom right;
      transition: opacity 0.35s cubic-bezier(0.16, 1, 0.3, 1),
        transform 0.35s cubic-bezier(0.16, 1, 0.3, 1),
        visibility 0.35s;
      z-index: 998;
      pointer-events: none;
    }

    .library-info-btn:hover+.library-info-card,
    .library-info-card:hover {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    /* Arrow pointing to button */
    .library-info-card::after {
      content: '';
      position: absolute;
      bottom: -8px;
      right: 22px;
      width: 16px;
      height: 16px;
      background: rgba(255, 255, 255, 0.98);
      border-right: 1px solid rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      transform: rotate(45deg);
    }

    /* Dark Mode Styles */
    .dark .library-info-btn {
      background: rgba(30, 41, 59, 0.95);
      border-color: rgba(59, 130, 246, 0.4);
      color: #60a5fa;
    }

    .dark .library-info-btn:hover {
      background: rgba(30, 41, 59, 1);
      border-color: rgba(59, 130, 246, 0.6);
    }

    .dark .library-info-card {
      background: rgba(30, 41, 59, 0.98);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .dark .library-info-card::after {
      background: rgba(30, 41, 59, 0.98);
      border-right-color: rgba(255, 255, 255, 0.1);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    /* Mobile Adjustments */
    @media (max-width: 768px) {
      .library-info-btn {
        bottom: 1.5rem;
        right: 1.5rem;
        width: 52px;
        height: 52px;
      }

      .library-info-card {
        bottom: 5rem;
        right: 1rem;
        left: 1rem;
        min-width: auto;
        max-width: none;
      }

      .library-info-card::after {
        right: 18px;
      }
    }

    /* Mini-Games Styling */
    .game-card {
      position: relative;
      cursor: pointer;
      outline: none;
    }

    .game-emoji {
      transition: transform 0.3s ease;
      display: inline-block;
    }

    .game-card:hover .game-emoji {
      transform: scale(1.1);
    }

    /* Bubble Animation */
    .bubble {
      position: absolute;
      bottom: 0;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(100, 200, 255, 0.4));
      animation: floatUp 3s ease-in-out forwards;
      pointer-events: none;
      box-shadow: 0 0 10px rgba(100, 200, 255, 0.5);
    }

    @keyframes floatUp {
      0% {
        bottom: 0;
        opacity: 1;
        transform: translateX(0) scale(1);
      }

      100% {
        bottom: 120%;
        opacity: 0;
        transform: translateX(var(--drift, 20px)) scale(1.5);
      }
    }

    /* Color Mood Pulse */
    .game-card.color-pulse {
      animation: colorPulse 1s ease-in-out;
    }

    @keyframes colorPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
        box-shadow: 0 0 20px currentColor;
      }
    }

    /* Lucky Number Spin */
    .lucky-spin {
      animation: spin 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg) scale(1);
      }

      50% {
        transform: rotate(180deg) scale(1.3);
      }

      100% {
        transform: rotate(360deg) scale(1);
      }
    }

    /* Breathing Animation */
    .breathing {
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {

      0%,
      100% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.7;
      }
    }

    /* Adjust main content for top navigation */
    .main-with-sidebar {
      padding-top: 5rem;
    }
  </style>
  <script src="https://unpkg.com/ogl@0.0.112/dist/ogl.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    // Language translations
    const translations = {
      en: {
        home: "Home",
        register: "Register",
        howToHelp: "How To / Help",
        settings: "Settings",
        profile: "Profile",
        map: "Map",
        report: "Report",
        logout: "Logout",
        dashboard: "Dashboard",
        welcomeBack: "Welcome Back",
        noiseLevel: "Noise Level",
        currentLevel: "Current Level",
        quiet: "Quiet",
        moderate: "Moderate",
        noisy: "Noisy",
        studentInfo: "Student Information",
        totalStudents: "Total Students",
        activeUsers: "Active Users",
        availableSeats: "Available Seats",
        occupiedSeats: "Occupied Seats",
        currentSession: "Current Session",
        seat: "Seat",
        duration: "Duration",
        studyStatus: "Study Status",
        active: "Active",
        studyTips: "Study Tips",
        selectSeat: "Select a Seat",
        close: "Close",
        notCheckedIn: "Not checked in",
        viewOnly: "View-only",
        readyToStudy: "Ready to study? Find a seat and get started!",
        librarySystem: "University of Makati Library",
        noiseComfort: "Noise Comfort Index"
      },
      fil: {
        home: "Tahanan",
        register: "Magparehistro",
        howToHelp: "Paano / Tulong",
        settings: "Mga Setting",
        profile: "Profile",
        map: "Mapa",
        report: "Mag-report",
        logout: "Mag-logout",
        dashboard: "Dashboard",
        welcomeBack: "Maligayang Pagbabalik",
        noiseLevel: "Antas ng Ingay",
        currentLevel: "Kasalukuyang Antas",
        quiet: "Tahimik",
        moderate: "Katamtaman",
        noisy: "Maingay",
        studentInfo: "Impormasyon ng Mag-aaral",
        totalStudents: "Kabuuang Mag-aaral",
        activeUsers: "Aktibong Gumagamit",
        availableSeats: "Available na Upuan",
        occupiedSeats: "Okupadong Upuan",
        currentSession: "Kasalukuyang Session",
        seat: "Upuan",
        duration: "Tagal",
        studyStatus: "Status ng Pag-aaral",
        active: "Aktibo",
        studyTips: "Mga Tip sa Pag-aaral",
        selectSeat: "Piliin ang Upuan",
        close: "Isara",
        notCheckedIn: "Hindi pa nag-check in",
        viewOnly: "Tingnan lamang",
        readyToStudy: "Handa na bang mag-aral? Maghanap ng upuan at magsimula na!",
        days: "araw",
        hours: "oras",
        librarySystem: "Aklatan ng University of Makati",
        noiseComfort: "Index ng Kaginhawahan sa Ingay"
      }
    };

    // Function to update page language
    function updateLanguage(language) {
      const t = translations[language];
      if (!t) return;

      // Update all text elements
      const elements = {
        'home-tooltip': t.home,
        'register-tooltip': t.register,
        'help-tooltip': t.howToHelp,
        'settings-tooltip': t.settings,
        'dashboard-title': t.dashboard,
        'welcome-back': t.welcomeBack,
        'noise-level-title': t.noiseLevel,
        'current-level': t.currentLevel,
        'quiet-label': t.quiet,
        'moderate-label': t.moderate,
        'noisy-label': t.noisy,
        'student-info-title': t.studentInfo,
        'total-students': t.totalStudents,
        'active-users': t.activeUsers,
        'available-seats': t.availableSeats,
        'occupied-seats': t.occupiedSeats,
        'current-session-title': t.currentSession,
        'seat-label': t.seat,
        'duration-label': t.duration,
        'study-status-title': t.studyStatus,
        'active-label': t.active,
        'study-tips-title': t.studyTips,
        'select-seat-title': t.selectSeat,
        'close-btn': t.close,
        'ready-to-study': t.readyToStudy,
        'days-label': t.days,
        'hours-label': t.hours,
        'profile-tooltip': t.profile,
        'map-tooltip': t.map,
        'report-tooltip': t.report,
        'logout-btn': t.logout,
        'library-title': t.librarySystem,
        'footer-text': t.noiseComfort
      };

      // Update text content
      Object.entries(elements).forEach(([id, text]) => {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = text;
        }
      });

      // Update dynamic text that might be set by JavaScript
      const dynamicElements = {
        'currentSession': t.notCheckedIn,
        'environmentStatus': t.viewOnly
      };

      Object.entries(dynamicElements).forEach(([id, text]) => {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = text;
        }
      });
    }

    // Load saved language and apply it
    document.addEventListener('DOMContentLoaded', function () {
      const savedLanguage = localStorage.getItem('language');
      if (savedLanguage) {
        updateLanguage(savedLanguage);
      }
    });
  </script>
  <style>
    .fade-content {
      opacity: var(--fade-initial-opacity, 0);
      will-change: opacity, filter;
      transition: opacity var(--fade-duration, 1000ms) var(--fade-easing, ease-out),
        filter var(--fade-duration, 1000ms) var(--fade-easing, ease-out);
    }

    .fade-content.is-visible {
      opacity: 1;
      filter: none;
    }

    /* Global fade-in (same system as Frame 15) */
    [data-fade] {
      opacity: 0;
      --fade-init: 14px;
      --fade-filter: none;
      filter: var(--fade-filter) !important;
      transition: var(--fade-transition, opacity 1000ms ease-out, filter 1000ms ease-out) !important;
      will-change: opacity, filter;
    }

    [data-fade]:not([data-blur="false"]) {
      --fade-filter: blur(var(--fade-init));
    }

    /* Library-themed cursor follower - subtle and calm */
    .cursor-follower {
      position: fixed;
      top: 0;
      left: 0;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      pointer-events: none;
      transform: translate(-50%, -50%) scale(1);
      transition: opacity 200ms ease-out;
      will-change: transform, opacity;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      background: radial-gradient(circle, rgba(0, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0.05) 50%, rgba(0, 0, 0, 0.02) 100%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      opacity: 0;
      z-index: 1;
      /* Behind text and UI elements */
    }

    /* Dark mode - keep white cursor follower */
    @media (prefers-color-scheme: dark) {
      .cursor-follower {
        background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }
    }

    /* Manual dark mode class support */
    .dark .cursor-follower {
      background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    /* Hide on small screens and touch devices */
    @media (max-width: 640px) {
      .cursor-follower {
        display: none;
      }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .cursor-follower {
        display: none !important;
      }

      .card {
        transition: none !important;
      }

      .card:hover {
        transform: none !important;
      }

      .kpi-row {
        transition: none !important;
      }

      .btn-outline {
        transition: none !important;
      }

      .btn-outline:hover {
        transform: none !important;
      }

      .progress-fill {
        transition: none !important;
      }
    }

    /* Library background with blur effect */
    .library-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #f0f0f0;
      /* Fallback color in case image doesn't load */
      background-image: url('librarybg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(6px);
      -webkit-filter: blur(6px);
      transform: scale(1.05);
      /* Slightly larger to hide blur edges */
      pointer-events: none;
      opacity: 0.7;
      /* Make background darker by reducing opacity */
      z-index: -2;
    }

    /* Dark mode support for library background */
    @media (prefers-color-scheme: dark) {
      .library-background {
        filter: blur(6px) brightness(0.7);
        -webkit-filter: blur(6px) brightness(0.7);
      }
    }

    /* Manual dark mode class support */
    .dark .library-background {
      filter: blur(6px) brightness(0.7);
      -webkit-filter: blur(6px) brightness(0.7);
    }

    /* Override theme.css and Tailwind body background to show library background */
    body.bg-slate-50 {
      background-color: transparent !important;
    }

    body {
      background-color: transparent !important;
    }

    /* Enhanced footer with frosted glass effect */
    .footer-glass {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      color: #374151;
      font-weight: 500;
    }

    /* Dark mode footer */
    @media (prefers-color-scheme: dark) {
      .footer-glass {
        background: rgba(15, 23, 42, 0.85);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        color: #e5e7eb;
      }
    }

    /* Manual dark mode class support */
    .dark .footer-glass {
      background: rgba(15, 23, 42, 0.85);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      color: #e5e7eb;
    }
  </style>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <style>
    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }

    :root {
      --card-pad: 1.5rem;
    }

    .role-chip {
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 12px;
      background: #eef2ff;
      color: #3730a3;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 1.25rem;
      box-shadow:
        0 2px 8px rgba(0, 0, 0, 0.08),
        0 1px 3px rgba(0, 0, 0, 0.05);
      padding: var(--card-pad);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      position: relative;
      overflow: hidden;
      will-change: transform, box-shadow;
      transform: translateZ(0);
      cursor: pointer;
    }

    /* Touch device support */
    @media (hover: none) and (pointer: coarse) {
      .card:active {
        transform: translateY(-2px) translateZ(0) !important;
        box-shadow:
          0 8px 25px rgba(0, 0, 0, 0.15),
          0 4px 12px rgba(0, 0, 0, 0.1),
          0 2px 6px rgba(0, 0, 0, 0.05) !important;
        border-color: rgba(59, 130, 246, 0.3) !important;
        background: rgba(255, 255, 255, 0.98) !important;
      }
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
      transform: translateZ(0);
    }

    .card:hover {
      transform: translateY(-3px) translateZ(0) !important;
      box-shadow:
        0 12px 35px rgba(0, 0, 0, 0.2),
        0 6px 20px rgba(0, 0, 0, 0.15),
        0 3px 10px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(59, 130, 246, 0.1) !important;
      border-color: rgba(59, 130, 246, 0.3) !important;
      background: rgba(255, 255, 255, 0.98) !important;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--text-primary);
      letter-spacing: -0.025em;
      line-height: 1.3;
    }

    .meta {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      opacity: 0.8;
    }

    .kpi-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9375rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      transition: background-color 0.15s ease-out;
      will-change: background-color;
    }

    .kpi-row:last-child {
      border-bottom: none;
    }

    .kpi-row:hover {
      background: rgba(0, 0, 0, 0.02);
    }

    .avatar {
      width: 96px;
      height: 96px;
      border-radius: 9999px;
      background: color-mix(in srgb, var(--bg-surface) 85%, var(--bg-page));
      display: grid;
      place-items: center;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Dark mode support for enhanced cards */
    @media (prefers-color-scheme: dark) {
      .card {
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow:
          0 2px 8px rgba(0, 0, 0, 0.25),
          0 1px 3px rgba(0, 0, 0, 0.15);
      }

      .card::before {
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      }

      .card:hover {
        transform: translateY(-3px) translateZ(0) !important;
        box-shadow:
          0 12px 35px rgba(0, 0, 0, 0.5),
          0 6px 20px rgba(0, 0, 0, 0.4),
          0 3px 10px rgba(0, 0, 0, 0.3),
          0 0 0 1px rgba(59, 130, 246, 0.2) !important;
        border-color: rgba(59, 130, 246, 0.4) !important;
        background: rgba(15, 23, 42, 0.98) !important;
      }

      /* Touch device support for dark mode */
      @media (hover: none) and (pointer: coarse) {
        .card:active {
          transform: translateY(-2px) translateZ(0) !important;
          box-shadow:
            0 8px 25px rgba(0, 0, 0, 0.4),
            0 4px 12px rgba(0, 0, 0, 0.3),
            0 2px 6px rgba(0, 0, 0, 0.2) !important;
          border-color: rgba(59, 130, 246, 0.4) !important;
          background: rgba(15, 23, 42, 0.98) !important;
        }
      }

      .kpi-row {
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }

      .kpi-row:hover {
        background: rgba(255, 255, 255, 0.03);
      }
    }

    /* Manual dark mode class support */
    .dark .card {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow:
        0 2px 8px rgba(0, 0, 0, 0.25),
        0 1px 3px rgba(0, 0, 0, 0.15);
    }

    .dark .card::before {
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    }

    .dark .card:hover {
      transform: translateY(-3px) translateZ(0) !important;
      box-shadow:
        0 12px 35px rgba(0, 0, 0, 0.5),
        0 6px 20px rgba(0, 0, 0, 0.4),
        0 3px 10px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(59, 130, 246, 0.2) !important;
      border-color: rgba(59, 130, 246, 0.4) !important;
      background: rgba(15, 23, 42, 0.98) !important;
    }

    .dark .kpi-row {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .dark .kpi-row:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    /* Enhanced button styles for better integration */
    .btn-outline {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: var(--text-primary);
      transition: background-color 0.15s ease-out, border-color 0.15s ease-out, transform 0.15s ease-out;
      will-change: background-color, border-color, transform;
    }

    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.35);
      transform: translateY(-1px) translateZ(0);
    }

    /* Enhanced progress bars */
    .progress-bar {
      background: rgba(0, 0, 0, 0.08);
      border-radius: 9999px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      border-radius: 9999px;
      transition: width 0.3s ease-out;
      position: relative;
      will-change: width;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">
  <div id="cursor-follower" class="cursor-follower" aria-hidden="true"></div>
  <div id="library-background" class="library-background" aria-hidden="true"></div>
  <div id="veil-bg" aria-hidden="true" style="position:fixed;inset:0;pointer-events:none;z-index:1">
    <canvas id="veil-canvas" class="w-full h-full block"></canvas>
  </div>
  <!-- Modern Top Navigation Bar -->
  <!-- Collapsible Header Trigger Button -->
  <button id="headerTrigger" class="header-trigger" aria-label="Toggle header navigation">
    <svg class="header-trigger-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </button>

  <!-- Hover Label (appears to left of nav) -->
  <div id="navLabel" class="nav-label"></div>

  <nav id="headerNav" class="modern-sidebar header-collapsed" data-fade data-blur="true" data-initial-opacity="0"
    data-duration="1000">
    <!-- Brand/Logo -->
    <div class="sidebar-brand">
      <img src="UMak_Logo_Registered.png" alt="University of Makati Logo" />
    </div>

    <!-- Navigation Items -->
    <a href="Frame_11.html" class="sidebar-nav-item active" data-label="Profile">
      <i data-lucide="user" class="sidebar-icon"></i>
    </a>

    <a href="Frame_8.html" class="sidebar-nav-item" data-label="Map">
      <i data-lucide="map" class="sidebar-icon"></i>
    </a>

    <a href="Frame_16.html" class="sidebar-nav-item" data-label="Report">
      <i data-lucide="flag" class="sidebar-icon"></i>
    </a>

    <button id="logoutBtn" class="sidebar-nav-item" data-label="Logout">
      <i data-lucide="log-out" class="sidebar-icon"></i>
    </button>
  </nav>


  <!-- Burger Menu Button (Mobile Only) -->
  <button class="burger-menu-btn" id="burgerMenuBtn" aria-label="Toggle menu">
    <span class="burger-line"></span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

  <!-- Mobile Menu Panel -->
  <div class="mobile-menu-panel" id="mobileMenuPanel">
    <div class="mobile-menu-header">
      <img src="UMak_Logo_Registered.png" alt="UMak Logo" />
      <div class="mobile-menu-title">Dashboard</div>
    </div>

    <a href="Frame_11.html" class="mobile-nav-item active">
      <i data-lucide="user" class="mobile-nav-icon"></i>
      <span id="mobile-profile-label">Profile</span>
    </a>

    <a href="Frame_8.html" class="mobile-nav-item">
      <i data-lucide="map" class="mobile-nav-icon"></i>
      <span id="mobile-map-label">Map</span>
    </a>

    <a href="Frame_16.html" class="mobile-nav-item">
      <i data-lucide="flag" class="mobile-nav-icon"></i>
      <span id="mobile-report-label">Report</span>
    </a>

    <button id="logoutBtnMobile" class="mobile-nav-item">
      <i data-lucide="log-out" class="mobile-nav-icon"></i>
      <span id="mobile-logout-label">Logout</span>
    </button>
  </div>

  <main class="main-with-sidebar flex-1 flex items-start justify-center py-12 px-6" data-fade data-blur="true"
    data-initial-opacity="0" data-duration="1000" data-delay="50">
    <div class="w-full max-w-6xl">
      <div id="fade-content" class="fade-content" data-blur="true" data-duration="1000" data-easing="ease-out"
        data-initial-opacity="0" data-delay="0" data-threshold="0.1">

        <!-- Profile Header -->
        <section class="card mb-6" data-fade>
          <div class="flex items-start gap-6">
            <div class="avatar text-2xl" id="avatar">—</div>
            <div class="flex-1">
              <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                <div>
                  <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-semibold" id="displayName">—</h1>
                    <span id="roleChip" class="role-chip">Student</span>
                  </div>
                  <div class="meta mt-1">Student ID: <span id="studentId">—</span> <span class="mx-2">·</span> Program:
                    <span id="program">—</span>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <!-- Existing action is kept hidden to avoid changing logic -->
                  <button class="px-4 py-2 text-sm rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white hidden"
                    id="checkInBtn">Check In</button>
                </div>
              </div>
              <div class="meta mt-3">Current session: <span id="currentSession">Not checked in</span></div>
            </div>
          </div>
        </section>

        <!-- Complete Profile Banner/Form (hidden until needed) -->
        <section id="complete-profile" class="bg-white rounded-2xl shadow p-6 border border-yellow-100 mb-8 hidden">
          <div class="flex items-start gap-4">
            <div class="w-10 h-10 rounded-full bg-yellow-50 flex items-center justify-center">⚠️</div>
            <div class="flex-1">
              <h2 class="text-lg font-semibold mb-2">Complete your profile</h2>
              <p class="text-sm text-slate-600 mb-4">We need a few basic details to get you started.</p>
              <form id="profile-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="pf-first" class="block text-sm text-slate-700">First name</label>
                  <input id="pf-first" name="pf-first"
                    class="mt-1 block w-full rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                    placeholder="First name" />
                </div>
                <div>
                  <label for="pf-last" class="block text-sm text-slate-700">Last name</label>
                  <input id="pf-last" name="pf-last"
                    class="mt-1 block w-full rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                    placeholder="Last name" />
                </div>
                <div>
                  <label for="pf-studentId" class="block text-sm text-slate-700">Student ID <span
                      class="text-red-600">*</span></label>
                  <input id="pf-studentId" name="pf-studentId" required
                    class="mt-1 block w-full rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                    placeholder="Student ID" />
                </div>
                <div>
                  <label for="pf-program" class="block text-sm text-slate-700">Program <span
                      class="text-red-600">*</span></label>
                  <input id="pf-program" name="pf-program" required
                    class="mt-1 block w-full rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                    placeholder="e.g., BSIT" />
                </div>
                <div class="md:col-span-2 flex items-center justify-end gap-2 mt-2">
                  <button type="button" id="pf-cancel" class="px-3 py-2 text-sm rounded-lg btn-outline">Not now</button>
                  <button type="submit" id="pf-save"
                    class="px-4 py-2 text-sm rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white">Save</button>
                </div>
              </form>
              <div id="pf-msg" class="mt-3 text-sm text-slate-600 hidden"></div>
            </div>
          </div>
        </section>

        <!-- Current Session Status -->
        <section class="grid grid-cols-1 gap-6 mb-8">
          <div class="card">
            <h2 id="current-session-title" class="card-title">Current Session</h2>
            <div class="space-y-3">
              <div class="kpi-row"><span id="seat-label" class="meta">Seat</span><span id="currentSeat"
                  class="font-medium">—</span>
              </div>
              <div class="kpi-row"><span id="duration-label" class="meta">Duration</span><span id="sessionDuration"
                  class="font-medium">—</span></div>
              <div class="mt-4">
                <button id="checkOutBtn"
                  class="w-full px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white hidden">Check Out</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Motivational Banner -->
        <div id="motivationalBanner"
          class="mb-6 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-950/30 dark:to-purple-950/30 rounded-xl border border-indigo-100 dark:border-indigo-900/50 overflow-hidden shadow-sm hover:shadow-md transition-all duration-300"
          data-fade>
          <div class="px-6 py-3 flex items-center gap-4">
            <div id="quoteIcon" class="text-2xl flex-shrink-0 transition-all duration-700 ease-in-out">💡</div>
            <div id="quoteDisplay"
              class="flex-1 transition-all duration-700 ease-in-out min-h-[2.5rem] flex items-center">
              <p class="text-sm md:text-base font-medium text-slate-800 dark:text-slate-200 leading-relaxed"
                id="quoteText">
                Loading...
              </p>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
              <!-- Navigation Dots -->
              <div class="flex gap-1.5" id="quoteDots">
                <!-- Dots will be generated here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content Grid -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6" data-fade>
          <div class="lg:col-span-2 space-y-6">

            <!-- Noise Level Monitor (Prominent) -->
            <div class="card">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h2 id="noise-level-title" class="card-title">Table Noise Level</h2>
                  <div class="text-sm text-slate-500 mt-1" id="noiseTableLabel">No table selected</div>
                </div>
                <button id="refreshNoiseBtn"
                  class="px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Refresh
                </button>
              </div>

              <!-- Enhanced Vertical Noise Bar -->
              <div class="flex items-center justify-center gap-6 mb-6">
                <!-- The Bar Container (Larger) -->
                <div
                  class="relative w-24 h-64 bg-slate-100/80 dark:bg-slate-800/50 rounded-2xl overflow-hidden shadow-inner border-2 border-white/50 dark:border-slate-700/50">
                  <!-- Background gradient markers -->
                  <div class="absolute inset-0 flex flex-col">
                    <div class="flex-1 bg-gradient-to-b from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/30">
                    </div>
                    <div
                      class="flex-1 bg-gradient-to-b from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30">
                    </div>
                    <div
                      class="flex-1 bg-gradient-to-b from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30">
                    </div>
                  </div>

                  <!-- Animated noise level fill -->
                  <div id="noiseLevelFill"
                    class="absolute bottom-0 left-0 right-0 transition-all duration-500 ease-out rounded-t-2xl"
                    style="height: 25%; background: linear-gradient(to top, #10b981, #34d399);">
                  </div>

                  <!-- Level markers -->
                  <div class="absolute inset-0 flex flex-col justify-between py-3 px-2 pointer-events-none">
                    <div class="text-base font-bold text-red-600">🔴</div>
                    <div class="text-base font-bold text-yellow-600">🟡</div>
                    <div class="text-base font-bold text-green-600">🟢</div>
                  </div>
                </div>

                <!-- Level Info (Enhanced) -->
                <div class="flex-1 space-y-4">
                  <div class="space-y-2">
                    <div class="flex items-baseline gap-2">
                      <div id="noiseValue" class="text-5xl font-bold text-slate-800 dark:text-slate-100">42</div>
                      <div class="text-lg text-slate-500 dark:text-slate-400">dB</div>
                    </div>
                    <div id="noiseStatus" class="text-base font-semibold text-green-600">🟢 Quiet Environment</div>
                  </div>

                  <div class="space-y-2.5 text-sm text-slate-600 dark:text-slate-400">
                    <div class="flex items-center gap-2">
                      <div class="w-4 h-4 rounded-full bg-green-500 shadow-sm"></div>
                      <span class="font-medium">0-50 dB: Quiet</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-4 h-4 rounded-full bg-yellow-500 shadow-sm"></div>
                      <span class="font-medium">50-70 dB: Moderate</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-4 h-4 rounded-full bg-red-500 shadow-sm"></div>
                      <span class="font-medium">70+ dB: Noisy</span>
                    </div>
                  </div>

                  <div
                    class="text-xs text-slate-400 dark:text-slate-500 italic pt-2 border-t border-slate-200 dark:border-slate-700"
                    id="noiseTimestamp">
                    Updated just now
                  </div>
                </div>
              </div>

              <!-- Leave Seat Button -->
              <div class="mt-4">
                <button id="leaveSeatBtn"
                  class="w-full py-3 px-6 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-md hover:shadow-lg"
                  style="display: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  Leave Seat
                </button>
              </div>
            </div>

          </div>

          <!-- Right Column -->
          <div class="space-y-6">

            <!-- Stress Relief Mini-Games -->
            <div class="card">
              <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4 text-center">Quick Break Games 🎮
              </h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 text-center mb-4">Take a breather, you deserve it!
              </p>

              <div class="grid grid-cols-2 gap-3">
                <!-- Bubble Pop -->
                <button id="bubblePopBtn"
                  class="game-card flex flex-col items-center gap-2 p-4 rounded-xl bg-cyan-50 hover:bg-cyan-100 dark:bg-cyan-900/20 dark:hover:bg-cyan-900/30 border border-cyan-100 dark:border-cyan-800 transition-all duration-200 hover:scale-105 group relative overflow-hidden">
                  <div class="game-emoji text-4xl">🫧</div>
                  <span class="text-xs font-medium text-cyan-700 dark:text-cyan-300">Bubble Pop</span>
                  <span class="game-subtitle text-xs text-cyan-600 dark:text-cyan-400">Click me!</span>
                </button>

                <!-- Color Mood -->
                <button id="colorMoodBtn"
                  class="game-card flex flex-col items-center gap-2 p-4 rounded-xl bg-rose-50 hover:bg-rose-100 dark:bg-rose-900/20 dark:hover:bg-rose-900/30 border border-rose-100 dark:border-rose-800 transition-all duration-200 hover:scale-105 group">
                  <div class="game-emoji text-4xl">🎨</div>
                  <span class="text-xs font-medium text-rose-700 dark:text-rose-300">Color Mood</span>
                  <span class="game-subtitle text-xs text-rose-600 dark:text-rose-400">Click to vibe!</span>
                </button>

                <!-- Lucky Number -->
                <button id="luckyNumberBtn"
                  class="game-card flex flex-col items-center gap-2 p-4 rounded-xl bg-emerald-50 hover:bg-emerald-100 dark:bg-emerald-900/20 dark:hover:bg-emerald-900/30 border border-emerald-100 dark:border-emerald-800 transition-all duration-200 hover:scale-105 group">
                  <div class="game-emoji text-4xl" id="luckyNumberEmoji">🎲</div>
                  <span class="text-xs font-medium text-emerald-700 dark:text-emerald-300">Lucky Number</span>
                  <span class="game-subtitle text-xs text-emerald-600 dark:text-emerald-400" id="luckyNumberText">Roll
                    it!</span>
                </button>

                <!-- Breathing Exercise -->
                <button id="breathingBtn"
                  class="game-card flex flex-col items-center gap-2 p-4 rounded-xl bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/20 dark:hover:bg-indigo-900/30 border border-indigo-100 dark:border-indigo-800 transition-all duration-200 hover:scale-105 group relative">
                  <div class="game-emoji text-4xl" id="breathingEmoji">🌬️</div>
                  <span class="text-xs font-medium text-indigo-700 dark:text-indigo-300">Breathe</span>
                  <span class="game-subtitle text-xs text-indigo-600 dark:text-indigo-400" id="breathingText">Relax
                    now</span>
                </button>
              </div>
            </div>

          </div>
        </section>

      </div>
    </div>

    <!-- Floating Library Info Button (Bottom Right) -->
    <button id="libraryInfoBtn" class="library-info-btn" aria-label="Library information and contact">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </button>

    <!-- Library Info Card (Slides up on hover) -->
    <div id="libraryInfoCard" class="library-info-card">
      <!-- Hours Status -->
      <div class="flex items-center gap-2 mb-4 pb-3 border-b border-slate-200 dark:border-slate-700">
        <div class="flex items-center gap-2 flex-1">
          <div class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-sm font-semibold text-slate-900 dark:text-slate-100">Open Now</span>
        </div>
        <span class="text-xs text-slate-600 dark:text-slate-400 font-medium">Mon-Fri 7AM-8PM</span>
      </div>

      <!-- Quick Actions -->
      <div class="grid grid-cols-3 gap-2 mb-3">
        <!-- Phone -->
        <a href="tel:+6288831134"
          class="flex flex-col items-center gap-1.5 p-3 rounded-lg bg-slate-50 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-blue-900/30 border border-slate-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-500 transition-all duration-200 group">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform" fill="none"
            stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Call</span>
        </a>

        <!-- Email -->
        <a href="mailto:library@umak.edu.ph"
          class="flex flex-col items-center gap-1.5 p-3 rounded-lg bg-slate-50 dark:bg-slate-800 hover:bg-green-50 dark:hover:bg-green-900/30 border border-slate-200 dark:border-slate-700 hover:border-green-300 dark:hover:border-green-500 transition-all duration-200 group">
          <svg class="w-5 h-5 text-green-600 dark:text-green-400 group-hover:scale-110 transition-transform" fill="none"
            stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Email</span>
        </a>

        <!-- Emergency -->
        <button onclick="alert('Emergency: Call Security at Local 8888')"
          class="flex flex-col items-center gap-1.5 p-3 rounded-lg bg-slate-50 dark:bg-slate-800 hover:bg-red-50 dark:hover:bg-red-900/30 border border-slate-200 dark:border-slate-700 hover:border-red-300 dark:hover:border-red-500 transition-all duration-200 group">
          <svg class="w-5 h-5 text-red-600 dark:text-red-400 group-hover:scale-110 transition-transform"
            fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
              clip-rule="evenodd" />
          </svg>
          <span class="text-xs font-medium text-slate-700 dark:text-slate-300">SOS</span>
        </button>
      </div>

      <!-- Location -->
      <div
        class="flex items-center gap-2 text-xs text-slate-600 dark:text-slate-400 pt-3 border-t border-slate-200 dark:border-slate-700">
        <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <span>J.P. Rizal Ext., Makati City</span>
      </div>
    </div>

  </main>
  <footer class="footer-glass text-center text-xs py-4" data-fade data-blur="true" data-initial-opacity="0"
    data-duration="1000" data-delay="100">© 2025 UMak Library · Noise Comfort Index</footer>

  <!-- Seat Selection Modal -->
  <div id="seatModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl">
      <div class="flex items-center justify-between mb-4">
        <h3 id="select-seat-title" class="text-lg font-semibold">Select a Seat</h3>
        <button id="closeSeatModal" class="px-2 py-1 text-sm btn-outline">Close</button>
      </div>
      <div class="grid grid-cols-5 gap-2 mb-4" id="seatGrid">
        <!-- Seats will be populated here -->
      </div>
      <div class="flex items-center justify-between text-sm text-slate-500">
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-1">
            <div class="w-3 h-3 rounded-full bg-green-500"></div> Available
          </div>
          <div class="flex items-center gap-1">
            <div class="w-3 h-3 rounded-full bg-red-500"></div> Occupied
          </div>
          <div class="flex items-center gap-1">
            <div class="w-3 h-3 rounded-full bg-yellow-500"></div> High Noise
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
  <script src="auth-guard.js"></script>
  <script src="security.js"></script>

  <script>
    // Noise monitoring system
    (function () {
      var checkInBtn = document.getElementById('checkInBtn');
      var checkOutBtn = document.getElementById('checkOutBtn');
      var seatModal = document.getElementById('seatModal');
      var closeSeatModal = document.getElementById('closeSeatModal');
      var logoutBtn = document.getElementById('logoutBtn');
      var logoutBtnMobile = document.getElementById('logoutBtnMobile');

      async function handleLogout() {
        console.log('[Logout] Starting logout process...');

        // Prevent multiple simultaneous logout attempts
        if (window._loggingOut) {
          console.log('[Logout] Already in progress, skipping...');
          return;
        }
        window._loggingOut = true;

        try {
          // Disable buttons to prevent double-clicks
          if (logoutBtn) logoutBtn.disabled = true;
          if (logoutBtnMobile) logoutBtnMobile.disabled = true;

          // Clear session storage
          try {
            sessionStorage.clear();
            console.log('[Logout] Session storage cleared');
          } catch (_) { }

          // Wait for Supabase to be available
          if (!window.supabaseAuth) {
            console.warn('[Logout] Supabase Auth not available, redirecting...');
            window.location.href = 'index.html?logout=1';
            return;
          }

          console.log('[Logout] Calling Supabase signOut...');
          const { error } = await window.supabaseAuth.signOut();

          if (error) {
            console.error('[Logout] Sign out error:', error);
          } else {
            console.log('[Logout] Sign out successful');
          }

          // Redirect to login page
          console.log('[Logout] Redirecting to login...');
          window.location.href = 'index.html?logout=1';
        } catch (err) {
          console.error('[Logout] Exception during logout:', err);
          // Force redirect even on error
          window.location.href = 'index.html?logout=1';
        }
      }

      if (logoutBtn) {
        logoutBtn.addEventListener('click', function (e) {
          e.preventDefault();
          handleLogout();
        });
      }
      if (logoutBtnMobile) {
        logoutBtnMobile.addEventListener('click', function (e) {
          e.preventDefault();
          handleLogout();
        });
      }

      // Disable reservation: hide modal trigger
      if (checkInBtn) { checkInBtn.classList.add('hidden'); }
      // Ensure modal remains closed
      if (seatModal) { seatModal.classList.add('hidden'); seatModal.classList.remove('flex'); }
      // Disable checkout
      if (checkOutBtn) { checkOutBtn.classList.add('hidden'); }

      function setText(id, text) {
        var el = document.getElementById(id);
        if (el) el.textContent = text != null && text !== '' ? String(text) : '';
      }
      function setValue(id, val) {
        var el = document.getElementById(id);
        if (el) el.value = val != null ? String(val) : '';
      }


      // Initialize Supabase
      var supabaseInitialized = false;
      try {
        if (initSupabase()) {
          supabaseInitialized = true;
          console.log('Supabase: Connected');
        } else {
          console.error('Supabase: Error');
        }
      } catch (err) {
        console.error('Supabase: Error', err);
      }

      function populateFromProfile(profile, user) {
        var fn = (profile && profile.firstName) || '';
        var ln = (profile && profile.lastName) || '';
        var display = (fn || ln) ? (fn + ' ' + ln).trim() : (user && user.email) || 'User';
        setText('displayName', display);
        var initials = (function () {
          var parts = display.trim().split(/\s+/).slice(0, 2);
          return parts.map(function (p) { return p[0] ? p[0].toUpperCase() : ''; }).join('');
        })();
        var avatarEl = document.getElementById('avatar');
        if (avatarEl && initials) avatarEl.textContent = initials;

        setText('studentId', ((profile && profile.studentId) ? String(profile.studentId).toUpperCase() : '—'));
        setText('program', profile && profile.program || '—');

        // Session data will be updated by updateCurrentSessionDisplay()
        setText('environmentStatus', 'View-only');
        if (checkInBtn) checkInBtn.classList.add('hidden');

        // Environment preferences
        var noisePrefs = profile && profile.noisePreferences || {};
        setText('noiseAlerts', noisePrefs.alerts !== false ? 'On' : 'Off');
      }

      function formatDuration(startTime) {
        if (!startTime) return '—';
        var now = Date.now();
        var elapsed = now - startTime;
        var hours = Math.floor(elapsed / 3600000);
        var minutes = Math.floor((elapsed % 3600000) / 60000);
        return hours + 'h ' + minutes + 'm';
      }

      function loadAvailableSeats() {
        if (!db) return;
        db.ref('occupancy').once('value').then(function (snap) {
          var data = snap && snap.val ? (snap.val() || {}) : {};
          renderSeatViews(data);
        }).catch(function (_) { });
      }

      function subscribeSeatsRealtime() {
        if (!db) return;
        db.ref('occupancy').on('value', function (snap) {
          var data = snap && snap.val ? (snap.val() || {}) : {};
          renderSeatViews(data);
        });
      }

      function renderSeatViews(occData) {
        try {
          var available = [];
          Object.keys(occData || {}).forEach(function (tableId) {
            var seats = (occData[tableId] && occData[tableId].seats) || {};
            Object.keys(seats).forEach(function (seatNum) {
              var isOccupied = !!seats[seatNum];
              if (!isOccupied) {
                available.push({ id: tableId + '-' + seatNum, tableId: tableId, seatNum: seatNum });
              }
            });
          });
          available.sort(function (a, b) { return a.id.localeCompare(b.id); });

          var panel = document.getElementById('availableSeats');
          if (panel) {
            panel.innerHTML = '';
            if (available.length === 0) {
              var empty = document.createElement('div');
              empty.className = 'text-center text-slate-500 text-sm col-span-5';
              empty.textContent = 'No available seats right now.';
              panel.appendChild(empty);
            } else {
              available.forEach(function (seat) {
                var btn = document.createElement('button');
                btn.className = 'px-3 py-2 rounded-lg bg-green-500 text-white text-sm hover:opacity-90 transition';
                btn.textContent = seat.id.replace('table-', 'Table ').replace('-', ' • Seat ');
                btn.addEventListener('click', function () { selectSeat(seat.id); });
                panel.appendChild(btn);
              });
            }
          }

          var grid = document.getElementById('seatGrid');
          if (grid) {
            grid.innerHTML = '';
            // Also show occupied seats in red for context
            var allSeats = [];
            Object.keys(occData || {}).forEach(function (tableId) {
              var seats = (occData[tableId] && occData[tableId].seats) || {};
              Object.keys(seats).forEach(function (seatNum) {
                var occ = !!seats[seatNum];
                allSeats.push({ id: tableId + '-' + seatNum, available: !occ });
              });
            });
            if (allSeats.length === 0) {
              var loading = document.createElement('div');
              loading.className = 'text-center text-slate-500 text-sm col-span-5';
              loading.textContent = 'No seats configured.';
              grid.appendChild(loading);
            } else {
              allSeats.sort(function (a, b) { return a.id.localeCompare(b.id); });
              allSeats.forEach(function (seat) {
                var btn = document.createElement('button');
                btn.className = 'w-12 h-12 rounded-lg text-sm font-medium ' + (seat.available ? 'bg-green-500 text-white' : 'bg-red-500 text-white');
                btn.textContent = seat.id.split('-').pop();
                btn.disabled = !seat.available;
                if (seat.available) btn.addEventListener('click', function () { selectSeat(seat.id); });
                grid.appendChild(btn);
              });
            }
          }
        } catch (_) { }
      }

      (function () {
        var el = document.getElementById('fade-content');
        if (!el) return;
        var duration = parseInt(el.getAttribute('data-duration') || '1000', 10);
        var easing = el.getAttribute('data-easing') || 'ease-out';
        var initial = parseFloat(el.getAttribute('data-initial-opacity') || '0');
        var blur = el.getAttribute('data-blur') === 'true';
        var delay = parseInt(el.getAttribute('data-delay') || '0', 10);
        var threshold = parseFloat(el.getAttribute('data-threshold') || '0.1');

        el.style.setProperty('--fade-duration', duration + 'ms');
        el.style.setProperty('--fade-easing', easing);
        el.style.setProperty('--fade-initial-opacity', String(initial));
        if (blur) el.style.filter = 'blur(10px)';

        var io = new IntersectionObserver(function (entries) {
          var e = entries[0];
          if (e && e.isIntersecting) {
            io.unobserve(el);
            setTimeout(function () {
              try { el.style.filter = 'none'; } catch (_) { }
              el.classList.add('is-visible');
            }, Math.max(0, delay));
          }
        }, { threshold: isNaN(threshold) ? 0.1 : threshold });

        io.observe(el);
      })();

      function selectSeat(seatId) {
        // Check in to seat (basic optimistic flow)
        console.log('Checking in to seat:', seatId);
        if (!auth || !db || !auth.currentUser) { return; }
        var uid = auth.currentUser.uid;
        var parts = String(seatId).split('-');
        var tableId = parts.slice(0, 2).join('-');
        var seatNum = parts[2];
        var updates = {};
        updates['occupancy/' + tableId + '/seats/' + seatNum] = true;
        updates['users/' + uid + '/currentSession'] = { seatId: seatId, startTime: Date.now(), noiseLevel: 0 };
        db.ref().update(updates).then(function () {
          if (seatModal) { seatModal.classList.add('hidden'); seatModal.classList.remove('flex'); }
        }).catch(function (err) { console.error('Check-in failed', err); });
      }

      function checkOut() {
        // Check out from current seat
        if (!auth || !db || !auth.currentUser) { return; }
        var uid = auth.currentUser.uid;
        db.ref('users/' + uid + '/currentSession').once('value').then(function (snap) {
          var cur = snap && snap.val ? (snap.val() || null) : null;
          if (!cur || !cur.seatId) return;
          var parts = String(cur.seatId).split('-');
          var tableId = parts.slice(0, 2).join('-');
          var seatNum = parts[2];
          var updates = {};
          updates['occupancy/' + tableId + '/seats/' + seatNum] = false;
          updates['users/' + uid + '/currentSession'] = null;
          db.ref().update(updates).catch(function (err) { console.error('Check-out failed', err); });
        });
      }

      function showCompleteProfile(profile, user) {
        var missing = [];
        if (!profile || !profile.firstName) missing.push('firstName');
        if (!profile || !profile.lastName) missing.push('lastName');
        if (!profile || !profile.studentId) missing.push('studentId');
        if (!profile || !profile.program) missing.push('program');
        var wrapper = document.getElementById('complete-profile');
        if (!wrapper) return;
        if (missing.length > 0) {
          wrapper.classList.remove('hidden');
          setValue('pf-first', (profile && profile.firstName) || '');
          setValue('pf-last', (profile && profile.lastName) || '');
          setValue('pf-studentId', (profile && profile.studentId) || '');
          setValue('pf-program', (profile && profile.program) || '');
        } else {
          wrapper.classList.add('hidden');
        }
      }

      function wireProfileForm(uid) {
        var form = document.getElementById('profile-form');
        var cancel = document.getElementById('pf-cancel');
        var msg = document.getElementById('pf-msg');
        function showMsg(text) { if (!msg) return; msg.textContent = text || ''; if (text) msg.classList.remove('hidden'); else msg.classList.add('hidden'); }
        if (cancel) cancel.addEventListener('click', function () { var w = document.getElementById('complete-profile'); if (w) w.classList.add('hidden'); });
        if (!form) return;
        form.addEventListener('submit', function (e) {
          e.preventDefault(); showMsg('Saving...');
          // Use snake_case to match Supabase users schema
          var updates = {
            first_name: (document.getElementById('pf-first') || {}).value || '',
            last_name: (document.getElementById('pf-last') || {}).value || '',
            student_id: (document.getElementById('pf-studentId') || {}).value || '',
            program: (document.getElementById('pf-program') || {}).value || ''
          };
          if (!updates.student_id || !updates.program) { showMsg('Student ID and Program are required.'); return; }
          if (supabaseInitialized) {
            window.supabaseDB.updateUser(uid, updates).then(function (result) {
              if (result.error) throw result.error;
              showMsg('Saved.');
              setTimeout(function () {
                showMsg('');
                var w = document.getElementById('complete-profile');
                if (w) w.classList.add('hidden');
              }, 1000);
            }).catch(function (err) {
              showMsg(err && err.message ? err.message : 'Failed to save.');
            });
          } else {
            showMsg('Database not connected.');
          }
        });
      }

      // Auth gate and data load
      if (supabaseInitialized) {
        window.supabaseAuth.onAuthStateChange(function (event, session) {
          if (!session || !session.user) {
            window.location.href = 'index.html';
            return;
          }
          var user = session.user;
          var uid = user.id;
          wireProfileForm(uid);

          // Load user profile
          window.supabaseDB.getUser(uid).then(function (result) {
            var profile = {};
            if (result && result.data) {
              profile = {
                firstName: result.data.first_name || '',
                lastName: result.data.last_name || '',
                studentId: result.data.student_id || '',
                program: result.data.program || ''
              };
            }
            populateFromProfile(profile, user);
            showCompleteProfile(profile, user);
          }).catch(function (err) {
            console.error('Error loading profile:', err);
            populateFromProfile({}, user);
            showCompleteProfile({}, user);
          });
        });
      } else {
        // If Supabase not initialized, redirect to login
        window.location.href = 'index.html';
      }


      // Initialize the page

    })();
  </script>
  <script>
    // DarkVeil background (WebGL via OGL) adapted for plain JS
    (function () {
      try {
        var canvas = document.getElementById('veil-canvas');
        var holder = document.getElementById('veil-bg');
        if (!canvas || !holder || !window.OGL) return;

        var hueShift = 0;
        var noiseIntensity = 0.02;
        var scanlineIntensity = 0.08;
        var speed = 0.5;
        var scanlineFrequency = 6.0;
        var warpAmount = 0.05;
        var resolutionScale = 1;

        var Renderer = OGL.Renderer, Program = OGL.Program, Mesh = OGL.Mesh, Triangle = OGL.Triangle, Vec2 = OGL.Vec2;

        var vertex = 'attribute vec2 position;\nvoid main(){gl_Position=vec4(position,0.0,1.0);}';
        var fragment = '#ifdef GL_ES\nprecision lowp float;\n#endif\nuniform vec2 uResolution;\nuniform float uTime;\nuniform float uHueShift;\nuniform float uNoise;\nuniform float uScan;\nuniform float uScanFreq;\nuniform float uWarp;\n#define iTime uTime\n#define iResolution uResolution\n\nvec4 buf[8];\nfloat rand(vec2 c){return fract(sin(dot(c,vec2(12.9898,78.233)))*43758.5453);}\n\nmat3 rgb2yiq=mat3(0.299,0.587,0.114,0.596,-0.274,-0.322,0.211,-0.523,0.312);\nmat3 yiq2rgb=mat3(1.0,0.956,0.621,1.0,-0.272,-0.647,1.0,-1.106,1.703);\n\nvec3 hueShiftRGB(vec3 col,float deg){\n    vec3 yiq=rgb2yiq*col;\n    float rad=radians(deg);\n    float cosh=cos(rad),sinh=sin(rad);\n    vec3 yiqShift=vec3(yiq.x,yiq.y*cosh-yiq.z*sinh,yiq.y*sinh+yiq.z*cosh);\n    return clamp(yiq2rgb*yiqShift,0.0,1.0);\n}\n\nvec4 sigmoid(vec4 x){return 1./(1.+exp(-x));}\n\nvec4 cppn_fn(vec2 coordinate,float in0,float in1,float in2){\n    buf[6]=vec4(coordinate.x,coordinate.y,0.3948333106474662+in0,0.36+in1);\n    buf[7]=vec4(0.14+in2,sqrt(coordinate.x*coordinate.x+coordinate.y*coordinate.y),0.,0.);\n    buf[0]=mat4(vec4(6.5404263,-3.6126034,0.7590882,-1.13613),vec4(2.4582713,3.1660357,1.2219609,0.06276096),vec4(-5.478085,-6.159632,1.8701609,-4.7742867),vec4(6.039214,-5.542865,-0.90925294,3.251348))*buf[6]+mat4(vec4(0.8473259,-5.722911,3.975766,1.6522468),vec4(-0.24321538,0.5839259,-1.7661959,-5.350116),vec4(0.,0.,0.,0.),vec4(0.,0.,0.,0.))*buf[7]+vec4(0.21808943,1.1243913,-1.7969975,5.0294676);\n    buf[1]=mat4(vec4(-3.3522482,-6.0612736,0.55641043,-4.4719114),vec4(0.8631464,1.7432913,5.643898,1.6106541),vec4(2.4941394,-3.5012043,1.7184316,6.357333),vec4(3.310376,8.209261,1.1355612,-1.165539))*buf[6]+mat4(vec4(5.24046,-13.034365,0.009859298,15.870829),vec4(2.987511,3.129433,-0.89023495,-1.6822904),vec4(0.,0.,0.,0.),vec4(0.,0.,0.,0.))*buf[7]+vec4(-5.9457836,-6.573602,-0.8812491,1.5436668);\n    buf[0]=sigmoid(buf[0]);buf[1]=sigmoid(buf[1]);\n    buf[2]=mat4(vec4(-15.219568,8.095543,-2.429353,-1.9381982),vec4(-5.951362,4.3115187,2.6393783,1.274315),vec4(-7.3145227,6.7297835,5.2473326,5.9411426),vec4(5.0796127,8.979051,-1.7278991,-1.158976))*buf[6]+mat4(vec4(-11.967154,-11.608155,6.1486754,11.237008),vec4(2.124141,-6.263192,-1.7050359,-0.7021966),vec4(0.,0.,0.,0.),vec4(0.,0.,0.,0.))*buf[7]+vec4(-4.17164,-3.2281182,-4.576417,-3.6401186);\n    buf[3]=mat4(vec4(3.1832156,-13.738922,1.879223,3.233465),vec4(0.64300746,12.768129,1.9141049,0.50990224),vec4(-0.049295485,4.4807224,1.4733979,1.801449),vec4(5.0039253,13.000481,3.3991797,-4.5561905))*buf[6]+mat4(vec4(-0.1285731,7.720628,-3.1425676,4.742367),vec4(0.6393625,3.714393,-0.8108378,-0.39174938),vec4(0.,0.,0.,0.),vec4(0.,0.,0.,0.))*buf[7]+vec4(-1.1811101,-21.621881,0.7851888,1.2329718);\n    buf[2]=sigmoid(buf[2]);buf[3]=sigmoid(buf[3]);\n    buf[4]=mat4(vec4(5.214916,-7.183024,2.7228765,2.6592617),vec4(-5.601878,-25.3591,4.067988,0.4602802),vec4(-10.57759,24.286327,21.102104,37.546658),vec4(4.3024497,-1.9625226,2.3458803,-1.372816))*buf[0]+mat4(vec4(-17.6526,-10.507558,2.2587414,12.462782),vec4(6.265566,-502.75443,-12.642513,0.9112289),vec4(-10.983244,20.741234,-9.701768,-0.7635988),vec4(5.383626,1.4819539,-4.1911616,-4.8444734))*buf[1]+mat4(vec4(12.785233,-16.345072,-0.39901125,1.7955981),vec4(-30.48365,-1.8345358,1.4542528,-1.1118771),vec4(19.872723,-7.337935,-42.941723,-98.52709),vec4(8.337645,-2.7312303,-2.2927687,-36.142323))*buf[2]+mat4(vec4(-16.298317,3.5471997,-0.44300047,-9.444417),vec4(57.5077,-35.609753,16.163465,-4.1534753),vec4(-0.07470326,-3.8656476,-7.0901804,3.1523974),vec4(-12.559385,-7.077619,1.490437,-0.8211543))*buf[3]+vec4(-7.67914,15.927437,1.3207729,-1.6686112);\n    buf[5]=mat4(vec4(-1.4109162,-0.372762,-3.770383,-21.367174),vec4(-6.2103205,-9.35908,0.92529047,8.82561),vec4(11.460242,-22.348068,13.625772,-18.693201),vec4(-0.3429052,-3.9905605,-2.4626114,-0.45033523))*buf[0]+mat4(vec4(7.3481627,-4.3661838,-6.3037653,-3.868115),vec4(1.5462853,6.5488915,1.9701879,-0.58291394),vec4(6.5858274,-2.2180402,3.7127688,-1.3730392),vec4(-5.7973905,10.134961,-2.3395722,-5.965605))*buf[1]+mat4(vec4(-2.5132585,-6.6685553,-1.4029363,-0.16285264),vec4(-0.37908727,0.53738135,4.389061,-1.3024765),vec4(-0.70647055,2.0111287,-5.1659346,-3.728635),vec4(-13.562562,10.487719,-0.9173751,-2.6487076))*buf[2]+mat4(vec4(-8.645013,6.5546675,-6.3944063,-5.5933375),vec4(-0.57783127,-1.077275,36.91025,5.736769),vec4(14.283112,3.7146652,7.1452246,-4.5958776),vec4(2.7192075,3.6021907,-4.366337,-2.3653464))*buf[3]+vec4(-5.9000807,-4.329569,1.2427121,8.59503);\n    buf[4]=sigmoid(buf[4]);buf[5]=sigmoid(buf[5]);\n    buf[6]=mat4(vec4(-1.61102,0.7970257,1.4675229,0.20917463),vec4(-28.793737,-7.1390953,1.5025433,4.656581),vec4(-10.94861,39.66238,0.74318546,-10.095605),vec4(-0.7229728,-1.5483948,0.7301322,2.1687684))*buf[0]+mat4(vec4(3.2547753,21.489103,-1.0194173,-3.3100595),vec4(-3.7316632,-3.3792162,-7.223193,-0.23685838),vec4(13.1804495,0.7916005,5.338587,5.687114),vec4(-4.167605,-17.798311,-6.815736,-1.6451967))*buf[1]+mat4(vec4(0.604885,-7.800309,-7.213122,-2.741014),vec4(-3.522382,-0.12359311,-0.5258442,0.43852118),vec4(9.6752825,-22.853785,2.062431,0.099892326),vec4(-4.3196306,-17.730087,2.5184598,5.30267))*buf[2]+mat4(vec4(-6.545563,-15.790176,-6.0438633,-5.415399),vec4(-43.591583,28.551912,-16.00161,18.84728),vec4(4.212382,8.394307,3.0958717,8.657522),vec4(-5.0237565,-4.450633,-4.4768,-5.5010443))*buf[3]+mat4(vec4(1.6985557,-67.05806,6.897715,1.9004834),vec4(1.8680354,2.3915145,2.5231109,4.081538),vec4(11.158006,1.7294737,2.0738268,7.386411),vec4(-4.256034,-306.24686,8.258898,-17.132736))*buf[4]+mat4(vec4(1.6889864,-4.5852966,3.8534803,-6.3482175),vec4(1.3543309,-1.2640043,9.932754,2.9079645),vec4(-5.2770967,0.07150358,-0.13962056,3.3269649),vec4(28.34703,-4.918278,6.1044083,4.085355))*buf[5]+vec4(6.6818056,12.522166,-3.7075126,-4.104386);\n    buf[7]=mat4(vec4(-8.265602,-4.7027016,5.098234,0.7509808),vec4(8.6507845,-17.15949,16.51939,-8.884479),vec4(-4.036479,-2.3946867,-2.6055532,-1.9866527),vec4(-2.2167742,-1.8135649,-5.9759874,4.8846445))*buf[0]+mat4(vec4(6.7790847,3.5076547,-2.8191125,-2.7028968),vec4(-5.743024,-0.27844876,1.4958696,-5.0517144),vec4(13.122226,15.735168,-2.9397483,-4.101023),vec4(-14.375265,-5.030483,-6.2599335,2.9848232))*buf[1]+mat4(vec4(4.0950394,-0.94011575,-5.674733,4.755022),vec4(4.3809423,4.8310084,1.7425908,-3.437416),vec4(2.117492,0.16342592,-104.56341,16.949184),vec4(-5.22543,-2.994248,3.8350096,-1.9364246))*buf[2]+mat4(vec4(-5.900337,1.7946124,-13.604192,-3.8060522),vec4(6.6583457,31.911177,25.164474,91.81147),vec4(11.840538,4.1503043,-0.7314397,6.768467),vec4(-6.3967767,4.034772,6.1714606,-0.32874924))*buf[3]+mat4(vec4(3.4992442,-196.91893,-8.923708,2.8142626),vec4(3.4806502,-3.1846354,5.1725626,5.1804223),vec4(-2.4009497,15.585794,1.2863957,2.0252278),vec4(-71.25271,-62.441242,-8.138444,0.50670296))*buf[4]+mat4(vec4(-12.291733,-11.176166,-7.3474145,4.390294),vec4(10.805477,5.6337385,-0.9385842,-4.7348723),vec4(-12.869276,-7.039391,5.3029537,7.5436664),vec4(1.4593618,8.91898,3.5101583,5.840625))*buf[5]+vec4(2.2415268,-6.705987,-0.98861027,-2.117676);\n    buf[6]=sigmoid(buf[6]);buf[7]=sigmoid(buf[7]);\n    buf[0]=mat4(vec4(1.6794263,1.3817469,2.9625452,0.),vec4(-1.8834411,-1.4806935,-3.5924516,0.),vec4(-1.3279216,-1.0918057,-2.3124623,0.),vec4(0.2662234,0.23235129,0.44178495,0.))*buf[0]+mat4(vec4(-0.6299101,-0.5945583,-0.9125601,0.),vec4(0.17828953,0.18300213,0.18182953,0.),vec4(-2.96544,-2.5819945,-4.9001055,0.),vec4(1.4195864,1.1868085,2.5176322,0.))*buf[1]+mat4(vec4(-1.2584374,-1.0552157,-2.1688404,0.),vec4(-0.7200217,-0.52666044,-1.438251,0.),vec4(0.15345335,0.15196142,0.272854,0.),vec4(0.945728,0.8861938,1.2766753,0.))*buf[2]+mat4(vec4(-2.4218085,-1.968602,-4.35166,0.),vec4(-22.683098,-18.0544,-41.954372,0.),vec4(0.63792,0.5470648,1.1078634,0.),vec4(-1.5489894,-1.3075932,-2.6444845,0.))*buf[3]+mat4(vec4(-0.49252132,-0.39877754,-0.91366625,0.),vec4(0.95609266,0.7923952,1.640221,0.),vec4(0.30616966,0.15693925,0.8639857,0.),vec4(1.1825981,0.94504964,2.176963,0.))*buf[4]+mat4(vec4(0.35446745,0.3293795,0.59547555,0.),vec4(-0.58784515,-0.48177817,-1.0614829,0.),vec4(2.5271258,1.9991658,4.6846647,0.),vec4(0.13042648,0.08864098,0.30187556,0.))*buf[5]+mat4(vec4(-1.7718065,-1.4033192,-3.3355875,0.),vec4(3.1664357,2.638297,5.378702,0.),vec4(-3.1724713,-2.6107926,-5.549295,0.),vec4(-2.851368,-2.249092,-5.3013067,0.))*buf[6]+mat4(vec4(1.5203838,1.2212278,2.8404984,0.),vec4(1.5210563,1.2651345,2.683903,0.),vec4(2.9789467,2.4364579,5.2347264,0.),vec4(2.2270417,1.8825914,3.8028636,0.))*buf[7]+vec4(-1.5468478,-3.6171484,0.24762098,0.);\n    buf[0]=sigmoid(buf[0]);\n    return vec4(buf[0].x,buf[0].y,buf[0].z,1.);\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n    vec2 uv=fragCoord/uResolution.xy*2.-1.;\n    uv.y*=-1.;\n    uv+=uWarp*vec2(sin(uv.y*6.283+uTime*0.5),cos(uv.x*6.283+uTime*0.5))*0.05;\n    fragColor=cppn_fn(uv,0.1*sin(0.3*uTime),0.1*sin(0.69*uTime),0.1*sin(0.44*uTime));\n}\n\nvoid main(){\n    vec4 col;mainImage(col,gl_FragCoord.xy);\n    col.rgb=hueShiftRGB(col.rgb,uHueShift);\n    float scanline_val=sin(gl_FragCoord.y*uScanFreq)*0.5+0.5;\n    col.rgb*=1.-(scanline_val*scanline_val)*uScan;\n    col.rgb+=(rand(gl_FragCoord.xy+uTime)-0.5)*uNoise;\n    gl_FragColor=vec4(clamp(col.rgb,0.0,1.0),1.0);\n}';

        var renderer = new Renderer({ dpr: Math.min(window.devicePixelRatio, 2), canvas: canvas });
        var gl = renderer.gl;
        var geometry = new Triangle(gl);
        var program = new Program(gl, {
          vertex: vertex,
          fragment: fragment,
          uniforms: {
            uTime: { value: 0 },
            uResolution: { value: new Vec2() },
            uHueShift: { value: hueShift },
            uNoise: { value: noiseIntensity },
            uScan: { value: scanlineIntensity },
            uScanFreq: { value: scanlineFrequency },
            uWarp: { value: warpAmount }
          }
        });
        var mesh = new Mesh(gl, { geometry: geometry, program: program });

        function resize() {
          var w = holder.clientWidth, h = holder.clientHeight;
          renderer.setSize(w * resolutionScale, h * resolutionScale);
          program.uniforms.uResolution.value.set(w, h);
        }
        window.addEventListener('resize', resize);
        resize();

        var start = performance.now();
        var rafId;
        function loop() {
          program.uniforms.uTime.value = ((performance.now() - start) / 1000) * speed;
          renderer.render({ scene: mesh });
          rafId = requestAnimationFrame(loop);
        }
        loop();

        window.addEventListener('beforeunload', function () { if (rafId) cancelAnimationFrame(rafId); });
      } catch (_) { }
    })();
  </script>
  <script>
    // Fade-on-scroll transitions (copied from Frame 15)
    (function () {
      var fadeElements = Array.from(document.querySelectorAll('[data-fade]'));
      if (fadeElements.length === 0) return;

      fadeElements.forEach(function (el) {
        var initialOpacity = parseFloat(el.getAttribute('data-initial-opacity') || '0');
        var duration = parseInt(el.getAttribute('data-duration') || '1000', 10);
        var easing = el.getAttribute('data-easing') || 'ease-out';
        var blurPxAttr = el.getAttribute('data-blur-px');
        var blurPx = parseInt(blurPxAttr || '14', 10);
        el.style.opacity = String(initialOpacity);
        el.style.setProperty('--fade-init', blurPx + 'px');
        el.style.setProperty('--fade-transition', 'opacity ' + duration + 'ms ' + easing + ', filter ' + duration + 'ms ' + easing);
      });

      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            var el = entry.target;
            var delay = parseInt(el.getAttribute('data-delay') || '0', 10);
            var blurAttr = el.getAttribute('data-blur');
            var blurEnabled = (blurAttr !== 'false');
            observer.unobserve(el);
            setTimeout(function () {
              el.style.opacity = '1';
              if (blurEnabled) {
                el.style.setProperty('--fade-init', '0px');
              }
            }, delay);
          }
        });
      }, { threshold: 0.1 });

      fadeElements.forEach(function (el) { observer.observe(el); });
    })();
  </script>
  <script>
    // Mobile Menu Toggle
    (function () {
      const burgerBtn = document.getElementById('burgerMenuBtn');
      const mobileOverlay = document.getElementById('mobileMenuOverlay');
      const mobilePanel = document.getElementById('mobileMenuPanel');
      const logoutBtnMobile = document.getElementById('logoutBtnMobile');

      if (!burgerBtn || !mobileOverlay || !mobilePanel) return;

      let isMenuOpen = false;

      function openMenu() {
        isMenuOpen = true;
        burgerBtn.classList.add('active');
        mobileOverlay.classList.add('active');
        mobilePanel.classList.add('active');
        document.documentElement.style.overflow = 'hidden';
      }

      function closeMenu() {
        isMenuOpen = false;
        burgerBtn.classList.remove('active');
        mobileOverlay.classList.remove('active');
        mobilePanel.classList.remove('active');
        document.documentElement.style.overflow = '';
      }

      function toggleMenu() {
        if (isMenuOpen) {
          closeMenu();
        } else {
          openMenu();
        }
      }

      burgerBtn.addEventListener('click', toggleMenu);
      mobileOverlay.addEventListener('click', closeMenu);

      const mobileNavItems = mobilePanel.querySelectorAll('.mobile-nav-item');
      mobileNavItems.forEach(item => {
        item.addEventListener('click', function (e) {
          // Close menu for navigation items (not logout - it handles itself)
          if (item.id !== 'logoutBtnMobile') {
            closeMenu();
          } else {
            // For logout button, just close the menu - logout handler is already attached
            closeMenu();
          }
        });
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && isMenuOpen) {
          closeMenu();
        }
      });

      window.addEventListener('resize', () => {
        if (window.innerWidth > 768 && isMenuOpen) {
          closeMenu();
        }
      });

      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    })();
  </script>
  <style>
    /* Make input text and placeholder clearly black in both themes */
    #profile-form input,
    #profile-form textarea {
      color: #000000;
      /* black */
    }

    #profile-form input::placeholder,
    #profile-form textarea::placeholder {
      color: #000000;
      /* black */
      opacity: 1;
    }

    /* Also apply to generic inputs if needed elsewhere on this page */
    input,
    textarea {
      color: #000000;
    }

    input::placeholder,
    textarea::placeholder {
      color: #000000;
      opacity: 1;
    }
  </style>
  <script>
    (function () {
      const follower = document.getElementById('cursor-follower');
      if (!follower) return;

      // Hide on touch devices
      const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
      if (isTouch) { follower.style.display = 'none'; return; }
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        follower.style.display = 'none'; return;
      }

      let mouseX = window.innerWidth / 2;
      let mouseY = window.innerHeight / 2;
      let posX = mouseX;
      let posY = mouseY;
      const ease = 0.08; // Slower, more gentle movement for library theme
      let isVisible = false;

      // Gentle fade in/out on mouse movement
      window.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        if (!isVisible) {
          follower.style.opacity = '0.6';
          isVisible = true;
        }
      }, { passive: true });

      // Fade out when mouse leaves window
      window.addEventListener('mouseleave', () => {
        follower.style.opacity = '0';
        isVisible = false;
      });

      // Smooth following animation
      function animate() {
        posX += (mouseX - posX) * ease;
        posY += (mouseY - posY) * ease;
        follower.style.transform = `translate(${posX}px, ${posY}px) translate(-50%, -50%)`;
        requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
    })();
  </script>

  <script>
    // Noise Level Monitoring System with Real-time Database Polling
    (function () {
      var noiseLevelFill = document.getElementById('noiseLevelFill');
      var noiseValue = document.getElementById('noiseValue');
      var noiseStatus = document.getElementById('noiseStatus');
      var noiseTableLabel = document.getElementById('noiseTableLabel');
      var noiseTimestamp = document.getElementById('noiseTimestamp');

      if (!noiseLevelFill || !noiseValue || !noiseStatus) return;

      // State variables
      var currentNoiseLevel = null; // Start with null to show "No data available"
      var lastUpdateTime = null;
      var hasData = false;


      // Update Current Session display
      var sessionStartTime = null;
      async function updateCurrentSessionDisplay() {
        try {
          const currentSessionEl = document.getElementById('currentSession');
          const currentSeatEl = document.getElementById('currentSeat');
          const sessionDurationEl = document.getElementById('sessionDuration');
          const checkOutBtn = document.getElementById('checkOutBtn');

          // Get current user
          const { data: { user }, error: userError } = await window.supabaseClient.auth.getUser();
          if (userError || !user) {
            if (currentSessionEl) currentSessionEl.textContent = 'Not checked in';
            if (currentSeatEl) currentSeatEl.textContent = '—';
            if (sessionDurationEl) sessionDurationEl.textContent = '—';
            if (checkOutBtn) checkOutBtn.classList.add('hidden');
            sessionStartTime = null;
            return;
          }

          // Get user's UID
          const { data: userData, error: uidError } = await window.supabaseClient
            .from('users')
            .select('uid')
            .eq('id', user.id)
            .single();

          if (uidError || !userData || !userData.uid) {
            if (currentSessionEl) currentSessionEl.textContent = 'Not checked in';
            if (currentSeatEl) currentSeatEl.textContent = '—';
            if (sessionDurationEl) sessionDurationEl.textContent = '—';
            if (checkOutBtn) checkOutBtn.classList.add('hidden');
            sessionStartTime = null;
            return;
          }

          // Check recent taps
          const { data: tapData, error: tapError } = await window.supabaseClient
            .from('recent_taps')
            .select('table_name, created_at')
            .eq('uid', userData.uid)
            .order('created_at', { ascending: false })
            .limit(1)
            .single();

          if (tapError || !tapData) {
            // No active session
            if (currentSessionEl) currentSessionEl.textContent = 'Not checked in';
            if (currentSeatEl) currentSeatEl.textContent = '—';
            if (sessionDurationEl) sessionDurationEl.textContent = '—';
            if (checkOutBtn) checkOutBtn.classList.add('hidden');
            sessionStartTime = null;
            return;
          }

          // User has an active session
          const tableName = tapData.table_name.replace('_', ' ');
          if (currentSessionEl) currentSessionEl.textContent = 'Checked in at ' + tableName;
          if (currentSeatEl) currentSeatEl.textContent = tableName;

          // Calculate duration
          if (!sessionStartTime) {
            sessionStartTime = new Date(tapData.created_at).getTime();
          }
          const now = Date.now();
          const durationMs = now - sessionStartTime;
          const hours = Math.floor(durationMs / (1000 * 60 * 60));
          const minutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));

          if (sessionDurationEl) {
            if (hours > 0) {
              sessionDurationEl.textContent = hours + 'h ' + minutes + 'm';
            } else {
              sessionDurationEl.textContent = minutes + 'm';
            }
          }

          // Show check out button (but keep it hidden since we use Leave Seat instead)
          // if (checkOutBtn) checkOutBtn.classList.add('hidden'); // Keep hidden

        } catch (err) {
          console.error('[Current Session] Error:', err);
        }
      }

      // Initialize displays
      updateDisplay(null);
      updateCurrentSessionDisplay(); // Initialize current session display

      // Update visual display
      function updateDisplay(level) {
        if (level === null || level === undefined) {
          // Show "No data available" state
          noiseValue.textContent = '--';
          noiseStatus.textContent = '⚪ Tap your RFID at a table';
          noiseStatus.className = 'text-base font-semibold text-slate-400 dark:text-slate-500';
          noiseLevelFill.style.height = '0%';
          noiseLevelFill.style.background = 'linear-gradient(to top, #9ca3af, #d1d5db)';
          noiseTimestamp.textContent = 'Tap RFID to start monitoring';
          hasData = false;
          return;
        }

        hasData = true;
        // Show decimal value (e.g., 12.37) instead of rounding
        var displayLevel = parseFloat(level).toFixed(1); // Shows one decimal place (e.g., 12.4)
        var percentage = Math.min(100, Math.max(0, ((level - 30) / (85 - 30)) * 100));

        // Update value display
        noiseValue.textContent = displayLevel;

        // Update bar height
        noiseLevelFill.style.height = percentage + '%';

        // Update colors and status based on level
        var status, statusColor, gradient;
        if (level < 50) {
          status = '🟢 Quiet Environment';
          statusColor = 'text-green-600';
          gradient = 'linear-gradient(to top, #10b981, #34d399)';
        } else if (level < 70) {
          status = '🟡 Moderate Noise';
          statusColor = 'text-yellow-600';
          gradient = 'linear-gradient(to top, #f59e0b, #fbbf24)';
        } else {
          status = '🔴 Noisy Environment';
          statusColor = 'text-red-600';
          gradient = 'linear-gradient(to top, #ef4444, #f87171)';
        }

        noiseStatus.textContent = status;
        noiseStatus.className = 'text-base font-semibold ' + statusColor;
        noiseLevelFill.style.background = gradient;

        // Update timestamp
        lastUpdateTime = Date.now();
        updateTimestamp();
      }

      // Update timestamp display
      function updateTimestamp() {
        if (!lastUpdateTime || !hasData) {
          noiseTimestamp.textContent = 'Tap RFID to start monitoring';
          return;
        }

        var now = Date.now();
        var seconds = Math.floor((now - lastUpdateTime) / 1000);

        if (seconds < 5) {
          noiseTimestamp.textContent = 'Updated just now';
        } else if (seconds < 60) {
          noiseTimestamp.textContent = 'Updated ' + seconds + 's ago';
        } else {
          var minutes = Math.floor(seconds / 60);
          noiseTimestamp.textContent = 'Updated ' + minutes + 'm ago';
        }
      }

      // Get the table the current user last tapped
      async function getUserTable() {
        try {
          // Get current user
          const { data: { user }, error: userError } = await window.supabaseClient.auth.getUser();

          if (userError || !user) {
            console.log('[Noise Monitor] No user logged in');
            return null;
          }

          console.log('[Noise Monitor] Current user:', user.id);

          // Get user's UID from users table
          const { data: userData, error: uidError } = await window.supabaseClient
            .from('users')
            .select('uid')
            .eq('id', user.id)
            .single();

          if (uidError || !userData || !userData.uid) {
            console.log('[Noise Monitor] User has no UID assigned yet');
            return null;
          }

          const userUid = userData.uid;
          console.log('[Noise Monitor] User UID:', userUid);

          // Query recent_taps to find the latest table this user tapped
          const { data: tapData, error: tapError } = await window.supabaseClient
            .from('recent_taps')
            .select('table_name, created_at')
            .eq('uid', userUid)
            .order('created_at', { ascending: false })
            .limit(1)
            .single();

          if (tapError || !tapData) {
            console.log('[Noise Monitor] No recent taps found for this user');
            return null;
          }

          console.log('[Noise Monitor] User last tapped:', tapData.table_name, 'at', tapData.created_at);
          return tapData.table_name;

        } catch (err) {
          console.error('[Noise Monitor] Error getting user table:', err);
          return null;
        }
      }

      // Fetch latest decibel value from latest_sound_per_table
      async function fetchLatestNoiseLevel() {
        try {
          console.log('[Noise Monitor] Fetching latest noise level...');

          // Check if Supabase is initialized
          if (!window.supabaseClient && typeof initSupabase === 'function') {
            console.log('[Noise Monitor] Supabase not found, attempting to initialize...');
            initSupabase();
          }

          if (!window.supabaseClient) {
            console.warn('[Noise Monitor] Supabase not initialized yet');
            updateDisplay(null);
            return;
          }

          // Get the table the user tapped
          const userTable = await getUserTable();

          if (!userTable) {
            console.log('[Noise Monitor] User has not tapped any table yet');
            updateDisplay(null);
            noiseTableLabel.textContent = 'No table selected';
            // Hide Leave Seat button when no table
            const leaveSeatBtn = document.getElementById('leaveSeatBtn');
            if (leaveSeatBtn) leaveSeatBtn.style.display = 'none';
            return;
          }

          console.log('[Noise Monitor] Querying latest_sound_per_table for', userTable);

          // Show Leave Seat button when table is detected
          const leaveSeatBtn = document.getElementById('leaveSeatBtn');
          if (leaveSeatBtn) leaveSeatBtn.style.display = 'flex';

          // Fetch from latest_sound_per_table for the user's table
          const { data, error } = await window.supabaseClient
            .from('latest_sound_per_table')
            .select('table_name, decibel, created_at')
            .eq('table_name', userTable)
            .single();

          if (error) {
            // If no data found (PGRST116), that's okay - show "No data available"
            if (error.code === 'PGRST116') {
              console.log('[Noise Monitor] No noise data available for', userTable, 'yet');
              updateDisplay(null);
              noiseTableLabel.textContent = userTable.replace('_', ' ');
              return;
            }
            console.error('[Noise Monitor] Query error:', error);
            throw error;
          }

          console.log('[Noise Monitor] Raw data received:', data);

          // Update display with fetched decibel value
          if (data && data.decibel !== null && data.decibel !== undefined) {
            currentNoiseLevel = parseFloat(data.decibel);
            console.log('[Noise Monitor] ✅ Successfully fetched:', currentNoiseLevel, 'dB from', data.table_name, 'at', data.created_at);

            updateDisplay(currentNoiseLevel);

            // Update the table label to show which table this reading is from
            if (data.table_name) {
              noiseTableLabel.textContent = data.table_name.replace('_', ' ');
            }
          } else {
            console.log('[Noise Monitor] No decibel value in latest record');
            updateDisplay(null);
          }
        } catch (err) {
          console.error('[Noise Monitor] ❌ Error fetching noise level:', err);
          updateDisplay(null);
        }
      }

      // Set up polling interval (3 seconds for more responsive updates)
      var pollingInterval = 3000; // 3 seconds
      var intervalId = null;
      var retryCount = 0;
      var maxRetries = 3;

      function startPolling() {
        // Initial fetch
        fetchLatestNoiseLevel();
        updateCurrentSessionDisplay();

        // Set up interval with better error handling
        intervalId = setInterval(function () {
          fetchLatestNoiseLevel().catch(function (err) {
            console.warn('[Noise Monitor] Polling error:', err);
            retryCount++;
            if (retryCount >= maxRetries) {
              console.error('[Noise Monitor] Max retries reached, stopping polling');
              clearInterval(intervalId);
              updateDisplay(null);
            }
          });
          updateCurrentSessionDisplay();
        }, pollingInterval);

        console.log('Noise level polling started - fetching every', pollingInterval / 1000, 'seconds');
      }

      // Update timestamp display and session duration every second
      setInterval(function () {
        updateTimestamp();
        updateCurrentSessionDisplay();
      }, 1000);

      // Add refresh button functionality
      var refreshNoiseBtn = document.getElementById('refreshNoiseBtn');
      if (refreshNoiseBtn) {
        refreshNoiseBtn.addEventListener('click', function () {
          console.log('[Noise Monitor] Manual refresh triggered');
          fetchLatestNoiseLevel();
          updateCurrentSessionDisplay();

          // Show loading state briefly
          refreshNoiseBtn.disabled = true;
          refreshNoiseBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> Refreshing...';

          setTimeout(function () {
            refreshNoiseBtn.disabled = false;
            refreshNoiseBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> Refresh';
          }, 1000);
        });
      }

      // Wait for Supabase to be initialized before starting polling
      setTimeout(function () {
        if (window.supabaseClient) {
          startPolling();
        } else {
          console.log('Waiting for Supabase initialization...');
          // Retry after a delay
          setTimeout(function () {
            if (window.supabaseClient) {
              startPolling();
            } else {
              console.error('Supabase not available - noise polling disabled');
              updateDisplay(null);
            }
          }, 2000);
        }
      }, 500);

      // Clean up on page unload
      window.addEventListener('beforeunload', function () {
        if (intervalId) {
          clearInterval(intervalId);
        }
      });

      console.log('Noise Level Monitor initialized - polling from latest_sound_per_table');

      // Leave Seat Button Functionality
      const leaveSeatBtn = document.getElementById('leaveSeatBtn');

      if (leaveSeatBtn) {
        leaveSeatBtn.addEventListener('click', async function () {
          try {
            leaveSeatBtn.disabled = true;
            leaveSeatBtn.textContent = 'Leaving...';

            // Get current user
            const { data: { user }, error: userError } = await window.supabaseClient.auth.getUser();

            if (userError || !user) {
              alert('Error: Could not get user information');
              leaveSeatBtn.disabled = false;
              leaveSeatBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> Leave Seat';
              return;
            }

            console.log('[Leave Seat] User:', user.id);

            // Get user's UID
            const { data: userData, error: uidError } = await window.supabaseClient
              .from('users')
              .select('uid')
              .eq('id', user.id)
              .single();

            if (uidError || !userData || !userData.uid) {
              console.error('[Leave Seat] Could not get user UID:', uidError);
              alert('Error leaving seat. Please try again.');
              leaveSeatBtn.disabled = false;
              leaveSeatBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> Leave Seat';
              return;
            }

            const userUid = userData.uid;
            console.log('[Leave Seat] User UID:', userUid);

            // Delete tap records for this user
            const { error: deleteError } = await window.supabaseClient
              .from('actlog_iot')
              .delete()
              .eq('uid', userUid)
              .eq('event', 'tap');

            if (deleteError) {
              console.error('[Leave Seat] Error deleting tap records:', deleteError);
            } else {
              console.log('[Leave Seat] ✅ Tap records deleted');
            }

            // Free up all seats occupied by this user
            const { data: updateData, error: updateError } = await window.supabaseClient
              .from('occupancy')
              .update({
                is_occupied: false,
                occupied_by: null,
                occupied_at: null,
                updated_at: new Date().toISOString()
              })
              .eq('occupied_by', user.id);

            if (updateError) {
              console.error('[Leave Seat] Error freeing seat:', updateError);
              alert('Error leaving seat. Please try again.');
              leaveSeatBtn.disabled = false;
              leaveSeatBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> Leave Seat';
              return;
            }

            console.log('[Leave Seat] ✅ Seat freed successfully');

            // Reset the display
            updateDisplay(null);
            noiseTableLabel.textContent = 'No table selected';
            sessionStartTime = null; // Reset session start time
            updateCurrentSessionDisplay(); // Update current session display
            leaveSeatBtn.style.display = 'none';
            leaveSeatBtn.disabled = false;
            leaveSeatBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> Leave Seat';

            console.log('[Leave Seat] Display reset complete');

          } catch (err) {
            console.error('[Leave Seat] Error:', err);
            alert('Error leaving seat. Please try again.');
            leaveSeatBtn.disabled = false;
            leaveSeatBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> Leave Seat';
          }
        });
      }
    })();

    // Library Info Button - Mobile Tap Toggle
    (function () {
      const infoBtn = document.getElementById('libraryInfoBtn');
      const infoCard = document.getElementById('libraryInfoCard');
      let isCardVisible = false;

      if (infoBtn && infoCard) {
        // For mobile: tap to toggle
        infoBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          isCardVisible = !isCardVisible;

          if (isCardVisible) {
            infoCard.style.opacity = '1';
            infoCard.style.visibility = 'visible';
            infoCard.style.transform = 'translateY(0) scale(1)';
            infoCard.style.pointerEvents = 'auto';
          } else {
            infoCard.style.opacity = '0';
            infoCard.style.visibility = 'hidden';
            infoCard.style.transform = 'translateY(20px) scale(0.95)';
            infoCard.style.pointerEvents = 'none';
          }
        });

        // Close card when clicking outside
        document.addEventListener('click', function (e) {
          if (!infoBtn.contains(e.target) && !infoCard.contains(e.target)) {
            isCardVisible = false;
            infoCard.style.opacity = '0';
            infoCard.style.visibility = 'hidden';
            infoCard.style.transform = 'translateY(20px) scale(0.95)';
            infoCard.style.pointerEvents = 'none';
          }
        });

        // Prevent card from closing when clicking inside it
        infoCard.addEventListener('click', function (e) {
          e.stopPropagation();
        });
      }
    })();

    // Stress Relief Mini-Games
    (function () {
      // 1. Bubble Pop Game
      const bubblePopBtn = document.getElementById('bubblePopBtn');
      if (bubblePopBtn) {
        bubblePopBtn.addEventListener('click', function (e) {
          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          bubble.style.left = Math.random() * 80 + 10 + '%';
          bubble.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
          this.appendChild(bubble);

          // Remove bubble after animation
          setTimeout(() => bubble.remove(), 3000);

          // Play "pop" feedback
          this.style.transform = 'scale(0.95)';
          setTimeout(() => { this.style.transform = ''; }, 100);
        });
      }

      // 2. Color Mood Changer
      const colorMoodBtn = document.getElementById('colorMoodBtn');
      const colors = [
        { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', name: 'Calm Purple' },
        { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', name: 'Energetic Pink' },
        { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', name: 'Cool Blue' },
        { bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', name: 'Fresh Green' },
        { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', name: 'Sunny Orange' },
        { bg: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', name: 'Deep Ocean' }
      ];

      if (colorMoodBtn) {
        colorMoodBtn.addEventListener('click', function () {
          const randomColor = colors[Math.floor(Math.random() * colors.length)];
          const banner = document.getElementById('motivationalBanner');

          if (banner) {
            banner.style.background = randomColor.bg;
            banner.style.transition = 'background 0.8s ease';
            console.log('Color changed to:', randomColor.name);
          } else {
            console.log('Banner not found!');
          }

          // Visual feedback
          this.classList.add('color-pulse');
          const subtitle = this.querySelector('.game-subtitle');
          if (subtitle) subtitle.textContent = randomColor.name + '!';

          setTimeout(() => {
            this.classList.remove('color-pulse');
            if (subtitle) subtitle.textContent = 'Click to vibe!';
          }, 1000);
        });
      }

      // 3. Lucky Number Generator
      const luckyNumberBtn = document.getElementById('luckyNumberBtn');
      const luckyNumberEmoji = document.getElementById('luckyNumberEmoji');
      const luckyNumberText = document.getElementById('luckyNumberText');
      const motivations = [
        "You're amazing! ⭐",
        "Keep shining! ✨",
        "You got this! 💪",
        "Believe in you! 🌟",
        "Stay strong! 🔥",
        "Almost there! 🎯",
        "You're a star! 🌠",
        "Keep going! 🚀"
      ];

      if (luckyNumberBtn && luckyNumberEmoji && luckyNumberText) {
        luckyNumberBtn.addEventListener('click', function () {
          // Spin animation
          luckyNumberEmoji.classList.add('lucky-spin');

          setTimeout(() => {
            const luckyNum = Math.floor(Math.random() * 100) + 1;
            const message = motivations[Math.floor(Math.random() * motivations.length)];

            luckyNumberEmoji.textContent = luckyNum;
            luckyNumberText.textContent = message;

            luckyNumberEmoji.classList.remove('lucky-spin');
          }, 600);

          // Reset after 3 seconds
          setTimeout(() => {
            luckyNumberEmoji.textContent = '🎲';
            luckyNumberText.textContent = 'Roll it!';
          }, 3500);
        });
      }

      // 4. Breathing Exercise
      const breathingBtn = document.getElementById('breathingBtn');
      const breathingEmoji = document.getElementById('breathingEmoji');
      const breathingText = document.getElementById('breathingText');
      let breathingActive = false;
      let breathingInterval;

      if (breathingBtn && breathingEmoji && breathingText) {
        breathingBtn.addEventListener('click', function () {
          if (breathingActive) {
            // Stop breathing exercise
            breathingActive = false;
            clearInterval(breathingInterval);
            breathingEmoji.classList.remove('breathing');
            breathingEmoji.textContent = '🌬️';
            breathingText.textContent = 'Relax now';
            this.style.borderColor = '';
          } else {
            // Start breathing exercise
            breathingActive = true;
            breathingEmoji.classList.add('breathing');
            this.style.borderColor = '#818cf8';

            let count = 0;
            const cycle = ['Breathe in... 🌬️', 'Hold... 😌', 'Breathe out... 💨', 'Hold... 😊'];

            breathingInterval = setInterval(() => {
              breathingText.textContent = cycle[count % 4];
              count++;

              if (count >= 16) { // 4 cycles
                breathingActive = false;
                clearInterval(breathingInterval);
                breathingEmoji.classList.remove('breathing');
                breathingEmoji.textContent = '✨';
                breathingText.textContent = 'Refreshed!';
                breathingBtn.style.borderColor = '';

                setTimeout(() => {
                  breathingEmoji.textContent = '🌬️';
                  breathingText.textContent = 'Relax now';
                }, 2000);
              }
            }, 4000); // 4 seconds per phase
          }
        });
      }
    })();

    // Motivational Quotes Carousel
    (function () {
      const quotes = [
        {
          text: "Success is the sum of small efforts, repeated day in and day out.",
          author: "Robert Collier",
          icon: "✨"
        },
        {
          text: "The secret of getting ahead is getting started.",
          author: "Mark Twain",
          icon: "🚀"
        },
        {
          text: "Don't watch the clock; do what it does. Keep going.",
          author: "Sam Levenson",
          icon: "⏰"
        },
        {
          text: "Education is the most powerful weapon which you can use to change the world.",
          author: "Nelson Mandela",
          icon: "📚"
        },
        {
          text: "The beautiful thing about learning is that no one can take it away from you.",
          author: "B.B. King",
          icon: "🌟"
        },
        {
          text: "Take regular breaks. Follow the 25-5 rule: study for 25 minutes, rest for 5.",
          author: "Study Tip",
          icon: "⏱️"
        },
        {
          text: "Stay hydrated! Keep water nearby and take regular hydration breaks.",
          author: "Health Tip",
          icon: "💧"
        },
        {
          text: "Organize your study space. A clean environment promotes better focus.",
          author: "Study Tip",
          icon: "🗂️"
        },
        {
          text: "Your limitation—it's only your imagination.",
          author: "Motivation",
          icon: "💪"
        },
        {
          text: "Great things never come from comfort zones.",
          author: "Motivation",
          icon: "🎯"
        },
        {
          text: "Dream it. Wish it. Do it.",
          author: "Motivation",
          icon: "✅"
        },
        {
          text: "Choose seats away from high-traffic areas for better concentration.",
          author: "Study Tip",
          icon: "🔇"
        },
        {
          text: "The expert in anything was once a beginner.",
          author: "Helen Hayes",
          icon: "🌱"
        },
        {
          text: "You don't have to be great to start, but you have to start to be great.",
          author: "Zig Ziglar",
          icon: "🏁"
        },
        {
          text: "Believe you can and you're halfway there.",
          author: "Theodore Roosevelt",
          icon: "🌈"
        }
      ];

      let currentIndex = 0;
      let rotationInterval = null;

      const quoteDisplay = document.getElementById('quoteDisplay');
      const quoteText = document.getElementById('quoteText');
      const quoteIcon = document.getElementById('quoteIcon');
      const dotsContainer = document.getElementById('quoteDots');

      if (!quoteDisplay || !quoteText || !quoteIcon || !dotsContainer) {
        console.warn('[Quotes] Elements not found');
        return;
      }

      // Create navigation dots (smaller for compact design)
      function createDots() {
        dotsContainer.innerHTML = quotes.map((_, index) =>
          `<button class="quote-dot w-1.5 h-1.5 rounded-full transition-all duration-300 cursor-pointer hover:bg-indigo-500 ${index === 0 ? 'bg-indigo-600 w-4' : 'bg-indigo-300'}" data-index="${index}" aria-label="Quote ${index + 1}"></button>`
        ).join('');

        // Add click handlers
        dotsContainer.querySelectorAll('.quote-dot').forEach((dot, index) => {
          dot.addEventListener('click', () => {
            currentIndex = index;
            showQuote(currentIndex);
            resetRotation();
          });
        });
      }

      // Show a specific quote with fade transition
      function showQuote(index) {
        const quote = quotes[index];

        // Fade out with scale
        quoteDisplay.style.opacity = '0';
        quoteDisplay.style.transform = 'scale(0.98)';
        quoteIcon.style.opacity = '0';
        quoteIcon.style.transform = 'scale(0.8)';

        setTimeout(() => {
          // Update content
          quoteIcon.textContent = quote.icon;
          quoteText.textContent = quote.text;

          // Update dots
          dotsContainer.querySelectorAll('.quote-dot').forEach((dot, i) => {
            if (i === index) {
              dot.classList.add('bg-indigo-600', 'w-4');
              dot.classList.remove('bg-indigo-300');
            } else {
              dot.classList.remove('bg-indigo-600', 'w-4');
              dot.classList.add('bg-indigo-300');
            }
          });

          // Fade in with scale
          quoteDisplay.style.opacity = '1';
          quoteDisplay.style.transform = 'scale(1)';
          quoteIcon.style.opacity = '1';
          quoteIcon.style.transform = 'scale(1)';
        }, 350);
      }

      // Go to next quote
      function nextQuote() {
        currentIndex = (currentIndex + 1) % quotes.length;
        showQuote(currentIndex);
      }

      // Start automatic rotation
      function startRotation() {
        rotationInterval = setInterval(nextQuote, 5000); // Change every 5 seconds
      }

      // Reset rotation timer
      function resetRotation() {
        if (rotationInterval) {
          clearInterval(rotationInterval);
        }
        startRotation();
      }

      // Initialize
      createDots();
      showQuote(0);
      startRotation();

      console.log('[Quotes] Carousel initialized with', quotes.length, 'quotes');
    })();

    // Nav Label Hover Functionality
    (function () {
      const navLabel = document.getElementById('navLabel');
      const navItems = document.querySelectorAll('.sidebar-nav-item');

      if (!navLabel || !navItems.length) return;

      navItems.forEach(item => {
        const label = item.getAttribute('data-label');
        if (!label) return;

        item.addEventListener('mouseenter', function () {
          navLabel.textContent = label;
          navLabel.classList.add('visible');
        });

        item.addEventListener('mouseleave', function () {
          navLabel.classList.remove('visible');
        });
      });
    })();

    // Collapsible Header Toggle (Desktop Only)
    (function () {
      const trigger = document.getElementById('headerTrigger');
      const headerNav = document.getElementById('headerNav');

      if (!trigger || !headerNav) return;

      let isExpanded = false;
      let isInitialized = false;

      function init() {
        const isMobile = window.innerWidth <= 768;

        if (isMobile) {
          trigger.style.display = 'none';
          headerNav.classList.remove('header-collapsed');
          headerNav.classList.add('header-expanded');
          trigger.classList.remove('trigger-collapsed', 'trigger-expanded');
        } else {
          trigger.style.display = 'flex';
          if (!isInitialized) {
            headerNav.classList.add('header-collapsed');
            headerNav.classList.remove('header-expanded');
            trigger.classList.add('trigger-collapsed');
            trigger.classList.remove('trigger-expanded', 'header-expanded');
            isExpanded = false;
          }
        }

        isInitialized = true;
      }

      function toggleHeader(e) {
        if (e) e.stopPropagation();

        isExpanded = !isExpanded;

        requestAnimationFrame(() => {
          if (isExpanded) {
            headerNav.classList.add('animating-in');
            headerNav.classList.remove('header-collapsed');
            headerNav.classList.add('header-expanded');
            trigger.classList.remove('trigger-collapsed');
            trigger.classList.add('trigger-expanded', 'header-expanded');

            setTimeout(() => {
              headerNav.classList.remove('animating-in');
            }, 500);
          } else {
            headerNav.classList.add('animating-out');
            headerNav.classList.add('header-collapsed');
            headerNav.classList.remove('header-expanded');
            trigger.classList.remove('trigger-expanded', 'header-expanded');
            trigger.classList.add('trigger-collapsed');

            setTimeout(() => {
              headerNav.classList.remove('animating-out');
            }, 500);
          }
        });
      }

      init();
      trigger.addEventListener('click', toggleHeader);

      let clickTimeout;
      document.addEventListener('click', function (e) {
        if (isExpanded &&
          !headerNav.contains(e.target) &&
          !trigger.contains(e.target)) {
          clearTimeout(clickTimeout);
          clickTimeout = setTimeout(() => {
            if (isExpanded) toggleHeader();
          }, 100);
        }
      });

      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && isExpanded) {
          toggleHeader();
        }
      });

      let resizeTimeout;
      window.addEventListener('resize', function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          init();
        }, 150);
      });
    })();

    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  </script>
</body>

</html>