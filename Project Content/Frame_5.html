<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="UMak_Logo_Registered.png" />
  <title>University of Makati Library - Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="theme.css" />
  <script defer src="theme.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    // Language translations
    const translations = {
      en: {
        home: "Home",
        register: "Register",
        howToHelp: "How To / Help",
        settings: "Settings",
        registerTitle: "Create Account",
        registerSubtitle: "Join the UMak Library community",
        firstName: "First Name",
        lastName: "Last Name",
        email: "Email Address",
        password: "Password",
        confirmPassword: "Confirm Password",
        studentId: "Student ID",
        course: "Course",
        yearLevel: "Year Level",
        agreeTerms: "I agree to the terms and conditions",
        createAccount: "Create Account",
        alreadyHaveAccount: "Already have an account?",
        signInHere: "Sign in here",
        librarySystem: "University of Makati Library",
        noiseComfort: "Noise Comfort Index"
      },
      fil: {
        home: "Tahanan",
        register: "Magparehistro",
        howToHelp: "Paano / Tulong",
        settings: "Mga Setting",
        registerTitle: "Gumawa ng Account",
        registerSubtitle: "Sumali sa komunidad ng Aklatan ng UMak",
        firstName: "Unang Pangalan",
        lastName: "Apelyido",
        email: "Email Address",
        password: "Password",
        confirmPassword: "Kumpirmahin ang Password",
        studentId: "Student ID",
        course: "Kurso",
        yearLevel: "Antas ng Taon",
        agreeTerms: "Sumasang-ayon ako sa mga tuntunin at kondisyon",
        createAccount: "Gumawa ng Account",
        alreadyHaveAccount: "May account na?",
        signInHere: "Mag-sign in dito",
        librarySystem: "Aklatan ng University of Makati",
        noiseComfort: "Index ng Kaginhawahan sa Ingay"
      }
    };

    // Function to update page language
    function updateLanguage(language) {
      const t = translations[language];
      if (!t) return;

      // Update all text elements
      const elements = {
        'home-tooltip': t.home,
        'register-tooltip': t.register,
        'help-tooltip': t.howToHelp,
        'settings-tooltip': t.settings,
        'register-title': t.registerTitle,
        'register-subtitle': t.registerSubtitle,
        'first-name-label': t.firstName,
        'last-name-label': t.lastName,
        'email-label': t.email,
        'password-label': t.password,
        'confirm-password-label': t.confirmPassword,
        'student-id-label': t.studentId,
        'course-label': t.course,
        'year-level-label': t.yearLevel,
        'agree-terms': t.agreeTerms,
        'create-account-btn': t.createAccount,
        'already-have-account': t.alreadyHaveAccount,
        'sign-in-link': t.signInHere,
        'library-title': t.librarySystem,
        'footer-text': t.noiseComfort
      };

      // Update text content
      Object.entries(elements).forEach(([id, text]) => {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = text;
        }
      });
    }

    // Load saved language and apply it
    document.addEventListener('DOMContentLoaded', function () {
      const savedLanguage = localStorage.getItem('language');
      if (savedLanguage) {
        updateLanguage(savedLanguage);
      }

      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    });
  </script>
  <style>
    .fade-content {
      opacity: var(--fade-initial-opacity, 0);
      will-change: opacity, filter;
      transition: opacity var(--fade-duration, 1000ms) var(--fade-easing, ease-out),
        filter var(--fade-duration, 1000ms) var(--fade-easing, ease-out);
    }

    .fade-content.is-visible {
      opacity: 1;
      filter: none;
    }
  </style>
  <style>
    /* Smooth, GPU-friendly crossfade for register wallpapers (match login feel) */
    #register-wallpaper .wall-slide {
      transition: opacity 1500ms ease-in-out;
    }

    /* Ensure wallpaper container spans and stacks correctly */
    #register-wallpaper {
      position: absolute;
      inset: 0;
    }

    /* Library-themed cursor follower - subtle and calm */
    .cursor-follower {
      position: fixed;
      top: 0;
      left: 0;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      pointer-events: none;
      transform: translate(-50%, -50%) scale(1);
      transition: opacity 200ms ease-out;
      will-change: transform, opacity;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      background: radial-gradient(circle, rgba(0, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0.05) 50%, rgba(0, 0, 0, 0.02) 100%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      opacity: 0;
      z-index: 1;
      /* Behind text and UI elements */
    }

    /* Dark mode - keep white cursor follower */
    @media (prefers-color-scheme: dark) {
      .cursor-follower {
        background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }
    }

    /* Manual dark mode class support */
    .dark .cursor-follower {
      background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    /* Hide on small screens and touch devices */
    @media (max-width: 640px) {
      .cursor-follower {
        display: none;
      }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .cursor-follower {
        display: none !important;
      }
    }

    /* Library background with blur effect */
    .library-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #f0f0f0;
      /* Fallback color in case image doesn't load */
      background-image: url('librarybg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(6px);
      -webkit-filter: blur(6px);
      transform: scale(1.05);
      /* Slightly larger to hide blur edges */
      pointer-events: none;
      opacity: 0.7;
      /* Make background darker by reducing opacity */
      z-index: -2;
    }

    /* Dark mode support for library background */
    @media (prefers-color-scheme: dark) {
      .library-background {
        filter: blur(6px) brightness(0.7);
        -webkit-filter: blur(6px) brightness(0.7);
      }
    }

    /* Manual dark mode class support */
    .dark .library-background {
      filter: blur(6px) brightness(0.7);
      -webkit-filter: blur(6px) brightness(0.7);
    }

    /* Override theme.css and Tailwind body background to show library background */
    body.bg-slate-50 {
      background-color: transparent !important;
    }

    body {
      background-color: transparent !important;
    }

    /* Enhanced footer with frosted glass effect */
    .footer-glass {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      color: #374151;
      font-weight: 500;
    }

    /* Dark mode footer */
    @media (prefers-color-scheme: dark) {
      .footer-glass {
        background: rgba(15, 23, 42, 0.85);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        color: #e5e7eb;
      }
    }

    /* Manual dark mode class support */
    .dark .footer-glass {
      background: rgba(15, 23, 42, 0.85);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      color: #e5e7eb;
    }

    /* Collapsible Header - Glassmorphic Arrow Trigger */
    .header-trigger {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%) translateY(0);
      z-index: 99999;
      width: 70px;
      height: 36px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
      -webkit-backdrop-filter: blur(30px) saturate(180%);
      backdrop-filter: blur(30px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-top: none;
      border-radius: 0 0 20px 20px;
      border-top-left-radius: 0 !important;
      border-top-right-radius: 0 !important;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1),
        height 0.35s cubic-bezier(0.4, 0, 0.2, 1),
        background 0.35s ease,
        box-shadow 0.35s ease,
        border-color 0.35s ease;
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.15),
        0 8px 24px rgba(99, 102, 241, 0.12),
        0 4px 12px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      outline: none;
      animation: headerPulse 2s ease-in-out infinite;
    }

    .header-trigger:hover {
      height: 42px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
      -webkit-backdrop-filter: blur(40px) saturate(200%);
      backdrop-filter: blur(40px) saturate(200%);
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.25),
        0 10px 32px rgba(99, 102, 241, 0.18),
        0 6px 16px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
      border-color: rgba(255, 255, 255, 0.75);
    }

    .header-trigger:active {
      transform: translateX(-50%) translateY(0) scale(0.95);
    }

    .header-trigger.trigger-expanded:active {
      transform: translateX(-50%) translateY(75px) scale(0.95);
    }

    .header-trigger-icon {
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      color: #6366f1;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .header-trigger:hover .header-trigger-icon {
      color: #4f46e5;
      transform: translateY(3px) scale(1.1);
    }

    .header-trigger.header-expanded .header-trigger-icon {
      transform: rotate(180deg) scale(1.1);
      color: #4f46e5;
    }

    /* Pulse animation */
    @keyframes headerPulse {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.15),
          0 8px 24px rgba(99, 102, 241, 0.12),
          0 4px 12px rgba(0, 0, 0, 0.08),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      50% {
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.3),
          0 10px 28px rgba(99, 102, 241, 0.2),
          0 6px 16px rgba(0, 0, 0, 0.12),
          inset 0 1px 0 rgba(255, 255, 255, 0.35);
      }
    }

    .header-trigger.header-expanded {
      animation: none;
    }

    /* Arrow follows header */
    .header-trigger.trigger-collapsed {
      transform: translateX(-50%) translateY(0);
      animation: arrowSlideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    .header-trigger.trigger-expanded {
      transform: translateX(-50%) translateY(75px);
      animation: arrowSlideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes arrowSlideDown {
      0% {
        transform: translateX(-50%) translateY(0);
      }

      100% {
        transform: translateX(-50%) translateY(75px);
      }
    }

    @keyframes arrowSlideUp {
      0% {
        transform: translateX(-50%) translateY(75px);
      }

      100% {
        transform: translateX(-50%) translateY(0);
      }
    }

    /* Modern Top Navigation Bar */
    .modern-sidebar {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      min-width: 320px;
      max-width: 500px;
      height: auto;
      background: rgba(255, 255, 255, 0.1);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-top: none;
      border-radius: 0 0 20px 20px;
      border-top-left-radius: 0 !important;
      border-top-right-radius: 0 !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
      z-index: 99998;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      padding: 1rem 2rem;
      gap: 1rem;
      transform-origin: top center;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
        opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1),
        filter 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      will-change: transform, opacity, filter;
      pointer-events: auto;
    }

    /* Collapsible Header States */
    .modern-sidebar.header-collapsed {
      transform: translateX(-50%) translateY(-120%);
      opacity: 0;
      filter: blur(10px);
      pointer-events: none;
    }

    .modern-sidebar.header-expanded {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
      filter: blur(0px);
      pointer-events: auto;
    }

    .modern-sidebar.animating-in {
      filter: blur(10px);
      animation: slideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .modern-sidebar.animating-out {
      filter: blur(10px);
      animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes slideDown {
      0% {
        transform: translateX(-50%) translateY(-120%);
        opacity: 0;
        filter: blur(10px);
      }

      100% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        filter: blur(0px);
      }
    }

    @keyframes slideUp {
      0% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        filter: blur(0px);
      }

      100% {
        transform: translateX(-50%) translateY(-120%);
        opacity: 0;
        filter: blur(10px);
      }
    }

    /* Hide trigger on mobile */
    @media (max-width: 768px) {
      .header-trigger {
        display: none;
      }

      .modern-sidebar.header-collapsed {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        pointer-events: auto;
      }
    }

    /* Top Navigation Items */
    .sidebar-nav-item {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #374151;
      text-decoration: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      will-change: transform, box-shadow, background;
    }

    .sidebar-nav-item:hover {
      transform: translateY(-2px) scale(1.05);
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 0 20px rgba(59, 130, 246, 0.3);
    }

    .sidebar-nav-item:active {
      transform: translateY(0) scale(0.98);
    }

    .sidebar-nav-item.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
      color: #3b82f6;
    }

    /* Sidebar Icons */
    .sidebar-icon {
      width: 24px;
      height: 24px;
      stroke-width: 1.5;
    }

    /* Tooltips */
    /* Nav Label (appears to left of nav container) */
    .nav-label {
      position: fixed;
      top: 22px;
      right: calc(50% + 210px);
      padding: 0.5rem 1rem;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      border-radius: 10px;
      font-size: 0.875rem;
      font-weight: 600;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      z-index: 99997;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .nav-label.visible {
      opacity: 1;
      visibility: visible;
    }

    /* Hide label on mobile */
    @media (max-width: 768px) {
      .nav-label {
        display: none;
      }
    }

    /* Logo/Brand in Top Navigation */
    .sidebar-brand {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.5rem;
      margin-right: 1rem;
    }

    .sidebar-brand img {
      width: 40px;
      height: 40px;
      border-radius: 8px;
    }

    .sidebar-brand-text {
      font-size: 0.75rem;
      font-weight: 600;
      color: #374151;
      text-align: center;
      line-height: 1.2;
    }

    /* Burger Menu Button - Hidden on Desktop */
    .burger-menu-btn {
      display: none;
      position: fixed;
      top: 1.25rem;
      right: 1.25rem;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .burger-menu-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .burger-menu-btn:active {
      transform: scale(0.95);
    }

    .burger-line {
      width: 20px;
      height: 2px;
      background: #1e293b;
      border-radius: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (prefers-color-scheme: dark) {
      .burger-line {
        background: #e2e8f0;
      }
    }

    .dark .burger-line {
      background: #e2e8f0;
    }

    .burger-menu-btn.active .burger-line:nth-child(1) {
      transform: translateY(6px) rotate(45deg);
    }

    .burger-menu-btn.active .burger-line:nth-child(2) {
      opacity: 0;
      transform: translateX(20px);
    }

    .burger-menu-btn.active .burger-line:nth-child(3) {
      transform: translateY(-6px) rotate(-45deg);
    }

    /* Mobile Menu Overlay */
    .mobile-menu-overlay {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }

    .mobile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    /* Mobile Menu Panel */
    .mobile-menu-panel {
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 280px;
      max-width: 85vw;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-left: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: -8px 0 32px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transform: translateX(100%);
      visibility: hidden;
      pointer-events: none;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s;
      overflow-y: auto;
      padding: 5rem 1.5rem 2rem;
    }

    .mobile-menu-panel.active {
      transform: translateX(0);
      visibility: visible;
      pointer-events: auto;
    }

    .mobile-menu-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .mobile-menu-header img {
      width: 36px;
      height: 36px;
      border-radius: 8px;
    }

    .mobile-menu-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1e293b;
    }

    .mobile-nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #334155;
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .mobile-nav-item:hover {
      background: rgba(99, 102, 241, 0.15);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateX(-4px);
    }

    .mobile-nav-item.active {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
      color: #4f46e5;
    }

    .mobile-nav-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Dark Mode for Mobile Menu */
    @media (prefers-color-scheme: dark) {
      .burger-menu-btn {
        background: rgba(30, 41, 59, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      }

      .burger-menu-btn:hover {
        background: rgba(30, 41, 59, 1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      }

      .mobile-menu-panel {
        background: rgba(15, 23, 42, 0.95);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu-title {
        color: #e2e8f0;
      }

      .mobile-nav-item {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #cbd5e1;
      }

      .mobile-nav-item:hover {
        background: rgba(99, 102, 241, 0.2);
        border-color: rgba(99, 102, 241, 0.4);
      }

      .mobile-nav-item.active {
        background: rgba(99, 102, 241, 0.3);
        border-color: rgba(99, 102, 241, 0.5);
        color: #a5b4fc;
      }
    }

    .dark .burger-menu-btn {
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
    }

    .dark .burger-menu-btn:hover {
      background: rgba(30, 41, 59, 1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    }

    .dark .mobile-menu-panel {
      background: rgba(15, 23, 42, 0.95);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
    }

    .dark .mobile-menu-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .dark .mobile-menu-title {
      color: #e2e8f0;
    }

    .dark .mobile-nav-item {
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #cbd5e1;
    }

    .dark .mobile-nav-item:hover {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
    }

    .dark .mobile-nav-item.active {
      background: rgba(99, 102, 241, 0.3);
      border-color: rgba(99, 102, 241, 0.5);
      color: #a5b4fc;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {

      /* Show burger menu button on mobile */
      .burger-menu-btn {
        display: flex;
      }

      .modern-sidebar {
        min-width: auto;
        padding: 0.75rem 1rem;
        gap: 0.75rem;
      }

      /* Hide navigation items on mobile, keep only logo */
      .sidebar-nav-item {
        display: none !important;
      }

      .sidebar-brand {
        border-right: none;
        margin-right: 0;
        padding-right: 0;
      }

      .sidebar-brand img {
        width: 32px;
        height: 32px;
      }

      .sidebar-brand-text {
        font-size: 0.625rem;
      }

    }

    /* Dark Mode Support */
    @media (prefers-color-scheme: dark) {
      .header-trigger {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(15, 23, 42, 0.2));
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.25),
          0 8px 24px rgba(0, 0, 0, 0.4),
          0 4px 12px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: headerPulseDark 2s ease-in-out infinite;
      }

      .header-trigger:hover {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.3));
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.35),
          0 10px 32px rgba(0, 0, 0, 0.5),
          0 6px 16px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.55);
      }

      .header-trigger.header-expanded {
        animation: none;
      }

      .header-trigger-icon {
        color: #818cf8;
      }

      .header-trigger:hover .header-trigger-icon {
        color: #a5b4fc;
      }

      @keyframes headerPulseDark {

        0%,
        100% {
          box-shadow: 0 0 20px rgba(99, 102, 241, 0.25),
            0 8px 24px rgba(0, 0, 0, 0.4),
            0 4px 12px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        50% {
          box-shadow: 0 0 35px rgba(99, 102, 241, 0.4),
            0 10px 28px rgba(0, 0, 0, 0.5),
            0 6px 16px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
      }

      .modern-sidebar {
        background: rgba(15, 23, 42, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-top: none;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
      }

      .sidebar-nav-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #e5e7eb;
      }

      .sidebar-nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.4);
      }

      .sidebar-nav-item.active {
        background: rgba(59, 130, 246, 0.3);
        border-color: rgba(59, 130, 246, 0.5);
        color: #60a5fa;
      }

      .sidebar-brand-text {
        color: #e5e7eb;
      }
    }

    /* Manual dark mode class support */
    .dark .header-trigger {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(15, 23, 42, 0.2));
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.25),
        0 8px 24px rgba(0, 0, 0, 0.4),
        0 4px 12px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      animation: headerPulseDark 2s ease-in-out infinite;
    }

    .dark .header-trigger:hover {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.3));
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.35),
        0 10px 32px rgba(0, 0, 0, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.55);
    }

    .dark .header-trigger.header-expanded {
      animation: none;
    }

    .dark .header-trigger-icon {
      color: #818cf8;
    }

    .dark .header-trigger:hover .header-trigger-icon {
      color: #a5b4fc;
    }

    .dark .modern-sidebar {
      background: rgba(15, 23, 42, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-top: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .dark .sidebar-nav-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e5e7eb;
    }

    .dark .sidebar-nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .dark .sidebar-nav-item.active {
      background: rgba(59, 130, 246, 0.3);
      border-color: rgba(59, 130, 246, 0.5);
      color: #60a5fa;
    }

    .dark .sidebar-brand-text {
      color: #e5e7eb;
    }

    /* Adjust main content for top navigation */
    .main-with-sidebar {
      margin-left: 0;
      padding-top: 100px;
      /* Add top padding to account for fixed top navigation */
    }

    @media (max-width: 768px) {
      .main-with-sidebar {
        padding-top: 80px;
        padding-left: 1rem;
        padding-right: 1rem;
        padding-bottom: 2rem;
        position: relative;
        z-index: 1;
      }

      /* Mobile optimizations for registration form */
      .w-full.max-w-6xl {
        max-width: 100%;
      }

      .bg-white.rounded-2xl {
        border-radius: 1rem;
        position: relative;
        z-index: 2;
      }

      /* Single column on mobile, hide wallpaper */
      .grid.grid-cols-1.md\:grid-cols-2 {
        grid-template-columns: 1fr !important;
      }

      .grid.grid-cols-1.md\:grid-cols-2>div:last-child {
        display: none;
      }

      /* Reduce padding on mobile */
      .grid.grid-cols-1.md\:grid-cols-2>div:first-child {
        padding: 1.5rem !important;
      }

      /* Adjust heading sizes for mobile */
      #register-title {
        font-size: 1.5rem !important;
        line-height: 2rem !important;
      }

      #register-subtitle {
        font-size: 0.875rem !important;
      }

      /* Ensure inputs are clickable with proper z-index */
      input[type="text"],
      input[type="email"],
      input[type="password"],
      select {
        position: relative;
        z-index: 10;
        padding: 0.75rem !important;
        font-size: 1rem !important;
        touch-action: manipulation;
      }

      /* Ensure labels are clickable */
      label {
        position: relative;
        z-index: 10;
        touch-action: manipulation;
      }

      /* Adjust button padding */
      button[type="submit"] {
        padding-top: 0.75rem !important;
        padding-bottom: 0.75rem !important;
        position: relative;
        z-index: 10;
      }

      /* Fix form z-index */
      #register-form {
        position: relative;
        z-index: 10;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 480px) {
      .main-with-sidebar {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }

      .grid.grid-cols-1.md\:grid-cols-2>div:first-child {
        padding: 1.25rem !important;
      }

      #register-title {
        font-size: 1.25rem !important;
        line-height: 1.75rem !important;
      }

      .grid.grid-cols-1.sm\:grid-cols-2 {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // Ensure Supabase is loaded before our script
    window.addEventListener('load', function () {
      if (typeof window.supabase === 'undefined') {
        console.error('Supabase library failed to load');
      } else {
        console.log('Supabase library loaded successfully');
      }
    });
  </script>
  <script>
    (function () {
      // Fixed wallpaper visibility and animation on Register frame
      // Lightweight crossfade for register wallpaper (mirrors login)
      function init() {
        var container = document.getElementById('register-wallpaper');
        if (!container) return;
        var slides = container.querySelectorAll('.wall-slide');
        if (!slides || slides.length < 2) return;

        var files = ['library1.jpg', 'library2.jpg', 'library3.jpg'];
        var index = 0;
        var DURATION = 1500; // ~1.5s fade (matches login)
        var INTERVAL = 2000; // cycle interval

        try {
          files.forEach(function (src) { var im = new Image(); im.src = src; console.log('[Register wallpaper] preload', src); });
        } catch (_) { }

        slides.forEach(function (img) {
          img.style.objectFit = 'cover';
          img.style.width = '100%';
          img.style.height = '100%';
          img.style.position = 'absolute';
          img.style.inset = '0';
          img.style.backfaceVisibility = 'hidden';
          img.style.willChange = 'opacity';
          img.setAttribute('aria-hidden', 'true');
        });

        function setSrc(img, i) { img.src = files[((i % files.length) + files.length) % files.length]; }
        var front = slides[0];
        var back = slides[1];
        setSrc(front, 0); setSrc(back, 1);
        try { console.log('[Register wallpaper] first image', front && front.src); } catch (_) { }
        front.classList.remove('opacity-0');
        back.classList.add('opacity-0');

        var busy = false;
        function crossfade() {
          if (busy) return;
          busy = true;
          var next = (index + 1) % files.length;
          setSrc(back, next);
          back.classList.add('opacity-0');
          requestAnimationFrame(function () {
            requestAnimationFrame(function () {
              front.classList.add('opacity-0');
              back.classList.remove('opacity-0');
            });
          });
          setTimeout(function () { var t = front; front = back; back = t; index = next; busy = false; }, DURATION + 50);
        }

        setInterval(crossfade, INTERVAL);
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
    })();
  </script>
  <script src="supabase.js"></script>
  <!-- AUTH-GUARD.JS REMOVED: Registration page should be publicly accessible without authentication checks -->
  <script src="password-toggle.js"></script>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">
  <div id="cursor-follower" class="cursor-follower" aria-hidden="true"></div>
  <div id="library-background" class="library-background" aria-hidden="true"></div>
  <!-- Modern Top Navigation Bar -->
  <!-- Collapsible Header Trigger Button -->
  <button id="headerTrigger" class="header-trigger" aria-label="Toggle header navigation">
    <svg class="header-trigger-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </button>

  <!-- Hover Label (appears to left of nav) -->
  <div id="navLabel" class="nav-label"></div>

  <nav id="headerNav" class="modern-sidebar header-collapsed" data-fade data-blur="true" data-initial-opacity="0"
    data-duration="1000">
    <!-- Brand/Logo -->
    <div class="sidebar-brand">
      <img src="UMak_Logo_Registered.png" alt="University of Makati Logo" />
    </div>

    <!-- Navigation Items -->
    <a href="index.html" class="sidebar-nav-item" data-label="Home">
      <i data-lucide="home" class="sidebar-icon"></i>
    </a>

    <a href="Frame_5.html" class="sidebar-nav-item active" data-label="Register">
      <i data-lucide="user-plus" class="sidebar-icon"></i>
    </a>

    <a href="how-to.html" class="sidebar-nav-item" data-label="How To / Help">
      <i data-lucide="help-circle" class="sidebar-icon"></i>
    </a>

    <a href="Settings.html" class="sidebar-nav-item" data-label="Settings">
      <i data-lucide="settings" class="sidebar-icon"></i>
    </a>
  </nav>

  <!-- Burger Menu Button (Mobile Only) -->
  <button class="burger-menu-btn" id="burgerMenuBtn" aria-label="Toggle menu">
    <span class="burger-line"></span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

  <!-- Mobile Menu Panel -->
  <div class="mobile-menu-panel" id="mobileMenuPanel">
    <div class="mobile-menu-header">
      <img src="UMak_Logo_Registered.png" alt="UMak Logo" />
      <div class="mobile-menu-title">Navigation</div>
    </div>

    <a href="index.html" class="mobile-nav-item">
      <i data-lucide="home" class="mobile-nav-icon"></i>
      <span id="mobile-home-label">Home</span>
    </a>

    <a href="Frame_5.html" class="mobile-nav-item active">
      <i data-lucide="user-plus" class="mobile-nav-icon"></i>
      <span id="mobile-register-label">Register</span>
    </a>

    <a href="how-to.html" class="mobile-nav-item">
      <i data-lucide="help-circle" class="mobile-nav-icon"></i>
      <span id="mobile-help-label">How To / Help</span>
    </a>

    <a href="Settings.html" class="mobile-nav-item">
      <i data-lucide="settings" class="mobile-nav-icon"></i>
      <span id="mobile-settings-label">Settings</span>
    </a>
  </div>

  <main class="main-with-sidebar flex-1 flex items-start justify-center py-12 px-6">
    <div class="w-full max-w-6xl">
      <div id="fade-content" class="fade-content" data-blur="true" data-duration="1000" data-easing="ease-out"
        data-initial-opacity="0">
        <!-- Two-column registration card matching Login aesthetic -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 items-stretch">
            <!-- Left: Registration form (vertically centered) -->
            <div class="p-8 md:p-10 flex items-center">
              <div class="w-full">
                <h1 id="register-title" class="text-2xl font-bold mb-2">Create Account</h1>
                <p id="register-subtitle" class="text-sm text-slate-500 mb-6">Join the UMak Library community</p>

                <!-- Status Messages -->
                <div id="register-error"
                  class="mb-4 text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg p-3 hidden"></div>
                <div id="register-success"
                  class="mb-4 text-sm text-green-600 bg-green-50 border border-green-100 rounded-lg p-4 hidden">
                  <div class="flex items-start">
                    <div class="flex-1">
                      <div id="success-message"></div>
                    </div>
                    <button id="close-success"
                      class="ml-2 text-green-500 hover:text-green-700 text-lg font-bold hidden transition-all duration-300 ease-in-out">&times;</button>
                  </div>
                  <!-- Resend verification controls (shown after signup) -->
                  <div id="resend-wrap" class="mt-3 hidden">
                    <div class="flex items-center gap-3">
                      <button id="resend-btn"
                        class="px-3 py-2 rounded-lg bg-green-600 text-white text-sm hover:bg-green-700 transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">Resend
                        verification email</button>
                      <span id="resend-timer" class="text-xs text-green-700"></span>
                    </div>
                    <p class="text-xs text-green-700 mt-2">For security, you can resend once every 2 minutes.</p>
                  </div>
                </div>
                <div id="register-loading"
                  class="mb-4 text-sm text-blue-600 bg-blue-50 border border-blue-100 rounded-lg p-3 hidden">
                  <div class="flex items-center">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                    Processing registration...
                  </div>
                </div>

                <!-- Inputs styled to match site theme; spacing unified -->
                <form id="register-form" class="space-y-5">
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label id="first-name-label" class="block text-sm text-slate-700 mb-1">First Name</label>
                      <input id="reg-first" type="text"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                        placeholder="Enter first name" required />
                    </div>
                    <div>
                      <label id="last-name-label" class="block text-sm text-slate-700 mb-1">Last Name</label>
                      <input id="reg-last" type="text"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                        placeholder="Enter last name" required />
                    </div>
                  </div>

                  <div>
                    <label id="email-label" class="block text-sm text-slate-700 mb-1">Email Address</label>
                    <input id="reg-email" type="email"
                      class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                      placeholder="your.email@umak.edu.ph" required />
                    <p class="text-xs text-slate-500 mt-1">Must be a University of Makati email address</p>
                  </div>

                  <div>
                    <label id="password-label" class="block text-sm text-slate-700 mb-1">Password</label>
                    <input id="reg-pass" type="password"
                      class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                      placeholder="Create a strong password" required minlength="6" />
                    <p class="text-xs text-slate-500 mt-1">Minimum 6 characters</p>
                  </div>

                  <div>
                    <label id="confirm-password-label" class="block text-sm text-slate-700 mb-1">Confirm
                      Password</label>
                    <input id="reg-pass-confirm" type="password"
                      class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                      placeholder="Re-enter your password" required minlength="6" />
                  </div>

                  <div>
                    <label class="block text-sm text-slate-700 mb-1">Student ID <span
                        class="text-red-600">*</span></label>
                    <input id="reg-student-id" type="text" required
                      class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none"
                      placeholder="Enter student ID" />
                  </div>

                  <div>
                    <label class="block text-sm text-slate-700 mb-1">Program <span class="text-red-600">*</span></label>
                    <select id="reg-program" required
                      class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none bg-white">
                      <option value="" disabled selected>Select your program</option>
                      <option value="BSCS">BSCS - Bachelor of Science in Computer Science</option>
                      <option value="BSIT">BSIT - Bachelor of Science in Information Technology</option>
                      <option value="APDEV">APDEV - Application Development</option>
                    </select>
                  </div>

                  <div>
                    <button type="submit" id="create-account-btn"
                      class="w-full py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-semibold transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                      Create Account
                    </button>
                  </div>
                </form>

                <div class="mt-6 text-center">
                  <p class="text-sm text-slate-500">
                    <span id="already-have-account">Already have an account?</span>
                    <a href="index.html" id="sign-in-link"
                      class="text-indigo-600 hover:text-indigo-700 font-medium transition-all duration-300 ease-in-out">Sign
                      in here</a>
                  </p>
                </div>
              </div>
            </div>

            <!-- Right: Background images with crossfade transitions -->
            <div class="relative min-h-[420px] md:min-h-[560px]">
              <div id="register-wallpaper" class="absolute inset-0 overflow-hidden">
                <!-- Background images with smooth crossfade transitions -->
                <img class="wall-slide opacity-0" alt="Library image 1" />
                <img class="wall-slide opacity-0" alt="Library image 2" />
              </div>
              <!-- Optional overlay branding -->
              <div class="relative z-[1] h-full flex items-end justify-between p-6">
                <div class="text-white drop-shadow-md">
                  <!-- Brand title fixed to white for visibility across light/dark modes -->
                  <h2 class="text-xl font-semibold !text-white dark:!text-white">University of Makati Library</h2>
                  <p class="text-sm opacity-90">Create your account to get started</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer-glass text-center text-xs py-4">© 2025 UMak Library · Noise Comfort Index</footer>
  <script>
    (function () {
      function initFadeContent() {
        var el = document.getElementById('fade-content');
        if (!el) return;
        var blur = el.getAttribute('data-blur') === 'true';
        var duration = parseInt(el.getAttribute('data-duration') || '1000', 10);
        var easing = el.getAttribute('data-easing') || 'ease-out';
        var initialOpacity = parseFloat(el.getAttribute('data-initial-opacity') || '0');

        el.style.setProperty('--fade-duration', duration + 'ms');
        el.style.setProperty('--fade-easing', easing);
        el.style.setProperty('--fade-initial-opacity', String(initialOpacity));
        if (blur) el.style.filter = 'blur(6px)';

        var io = new IntersectionObserver(function (entries) {
          entries.forEach(function (entry) {
            if (entry.isIntersecting) {
              try { el.style.filter = 'none'; } catch (_) { }
              el.classList.add('is-visible');
              if (io) io.disconnect();
            }
          });
        }, { threshold: 0.1 });
        io.observe(el);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFadeContent);
      } else {
        initFadeContent();
      }
    })();
  </script>

  <script>
    (function () {
      // Initialize Supabase with retry mechanism
      let supabaseInitialized = false;

      // Removed authentication check to prevent interference with registration access

      async function initializeSupabase() {
        try {
          // Try immediate initialization first
          if (initSupabase()) {
            supabaseInitialized = true;
            console.log('Supabase initialized successfully');
            return;
          }

          // If immediate initialization fails, try with retry mechanism
          console.log('Immediate initialization failed, trying with retry...');
          supabaseInitialized = await initSupabaseWithRetry();

          if (supabaseInitialized) {
            console.log('Supabase initialized successfully with retry');
          } else {
            console.error('Supabase initialization failed after retries');
          }
        } catch (err) {
          console.error('Supabase error:', err);
        }
      }

      // Initialize Supabase
      initializeSupabase();

      // UI Helper Functions
      function showError(message) {
        hideAllMessages();
        const el = document.getElementById('register-error');
        if (el) {
          el.textContent = message;
          el.classList.remove('hidden');
        }
      }

      function showSuccess(message, showCloseButton = false) {
        hideAllMessages();
        const el = document.getElementById('register-success');
        const messageEl = document.getElementById('success-message');
        const closeBtn = document.getElementById('close-success');

        if (el && messageEl) {
          messageEl.textContent = message;
          el.classList.remove('hidden');

          if (showCloseButton && closeBtn) {
            closeBtn.classList.remove('hidden');
          } else if (closeBtn) {
            closeBtn.classList.add('hidden');
          }
        }
      }

      function showLoading() {
        hideAllMessages();
        const el = document.getElementById('register-loading');
        if (el) {
          el.classList.remove('hidden');
        }
      }

      function hideAllMessages() {
        const messages = ['register-error', 'register-success', 'register-loading'];
        messages.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.classList.add('hidden');
        });
      }

      function setFormEnabled(enabled) {
        const form = document.getElementById('register-form');
        const inputs = form.querySelectorAll('input, button');
        inputs.forEach(input => {
          input.disabled = !enabled;
        });
      }

      // Form Validation
      function validateForm() {
        const firstName = document.getElementById('reg-first').value.trim();
        const lastName = document.getElementById('reg-last').value.trim();
        const email = document.getElementById('reg-email').value.trim();
        const password = document.getElementById('reg-pass').value;
        const confirmPassword = document.getElementById('reg-pass-confirm').value;
        const studentId = document.getElementById('reg-student-id').value.trim();
        const program = document.getElementById('reg-program').value.trim();

        if (!firstName) {
          showError('First name is required');
          return false;
        }

        if (!lastName) {
          showError('Last name is required');
          return false;
        }

        if (!email) {
          showError('Email address is required');
          return false;
        }

        if (!email.toLowerCase().endsWith('@umak.edu.ph')) {
          showError('Please use a University of Makati email address (@umak.edu.ph)');
          return false;
        }

        if (!password || password.length < 6) {
          showError('Password must be at least 6 characters long');
          return false;
        }

        if (password !== confirmPassword) {
          showError('Passwords do not match');
          return false;
        }

        if (!studentId) {
          showError('Student ID is required');
          return false;
        }

        if (!program) {
          showError('Program is required');
          return false;
        }

        return true;
      }

      // Rate limiting prevention
      let lastRegistrationAttempt = 0;
      const REGISTRATION_COOLDOWN = 10000; // 10 seconds

      // Registration Handler
      async function handleRegistration(event) {
        event.preventDefault();

        // Check rate limiting
        const now = Date.now();
        if (now - lastRegistrationAttempt < REGISTRATION_COOLDOWN) {
          const remainingTime = Math.ceil((REGISTRATION_COOLDOWN - (now - lastRegistrationAttempt)) / 1000);
          showError(`Please wait ${remainingTime} seconds before trying to register again.`);
          return;
        }
        lastRegistrationAttempt = now;

        // Wait for Supabase to initialize if not ready
        if (!supabaseInitialized) {
          showError('System is initializing. Please wait a moment and try again.');

          // Try to initialize again
          await initializeSupabase();

          if (!supabaseInitialized) {
            showError('System not initialized. Please refresh the page and try again.');
            return;
          }
        }

        if (!validateForm()) {
          return;
        }

        const firstName = document.getElementById('reg-first').value.trim();
        const lastName = document.getElementById('reg-last').value.trim();
        const email = document.getElementById('reg-email').value.trim();
        const password = document.getElementById('reg-pass').value;
        const studentId = document.getElementById('reg-student-id').value.trim();
        const program = document.getElementById('reg-program').value.trim();

        try {
          showLoading();
          setFormEnabled(false);

          // Prepare user data
          const userData = {
            first_name: firstName,
            last_name: lastName,
            student_id: studentId,
            program: program
          };

          console.log('Attempting registration with:', { email, userData });

          // Start 2-minute resend cooldown immediately on register click
          try {
            const cooldownKey = `verify-cooldown:${email.toLowerCase()}`;
            localStorage.setItem(cooldownKey, String(Date.now()));
            const resendWrapEarly = document.getElementById('resend-wrap');
            if (resendWrapEarly) resendWrapEarly.classList.remove('hidden');
            startOrUpdateResendCooldown(email);
          } catch (_) { }

          // Register user with Supabase and send email verification
          const redirectUrl = window.location.origin + '/index.html';
          const result = await window.supabaseAuth.signUpWithEmailVerification(email, password, userData, redirectUrl);

          if (result.error) {
            throw result.error;
          }

          console.log('Registration successful:', result.data);

          // Show success with verification message and expose resend controls
          console.log('Registration initiated. Verification email sent if not existing account.');
          showSuccess('Registration started! Please check your email and click the verification link to activate your account.');
          const resendWrap = document.getElementById('resend-wrap');
          if (resendWrap) resendWrap.classList.remove('hidden');
          // Start/update cooldown UI
          startOrUpdateResendCooldown(email);

        } catch (error) {
          console.error('Registration error:', error);

          if (error.message && error.message.includes('User already registered')) {
            // Check if it's just unverified or truly existing and verified
            try {
              const signInAttempt = await window.supabaseAuth.signIn(email, password);
              if (signInAttempt && signInAttempt.data && signInAttempt.data.user) {
                // Credentials are correct and account exists — show message but don't auto-redirect
                showSuccess('Account already exists. You can sign in from the login page.');
                return;
              }
            } catch (signinErr) {
              const msg = (signinErr && signinErr.message) ? signinErr.message : '';
              if (msg.toLowerCase().includes('email not confirmed')) {
                // Not verified yet – show verification guidance and enable resend
                showSuccess('Your account exists but is not verified yet. Please check your email or resend the verification.', true);
                const resendWrap2 = document.getElementById('resend-wrap');
                if (resendWrap2) resendWrap2.classList.remove('hidden');
                startOrUpdateResendCooldown(email);
                return;
              }
              if (msg.toLowerCase().includes('invalid login credentials')) {
                showError('This email is already registered. Please use Sign In with your password.');
                return;
              }
            }
            // Fallback generic message
            showError('This email is already registered. Please sign in instead.');
          } else if (error.message.includes('Password should be at least 6 characters')) {
            showError('Password must be at least 6 characters long.');
          } else if (error.message.includes('Invalid email')) {
            showError('Please enter a valid email address.');
          } else if (error.message.includes('rate limit') || error.message.includes('Too Many Requests')) {
            showError('Too many registration attempts. Please wait a moment before trying again.');
          } else if (error.code === 'cooldown_active' || (error.message && error.message.includes('wait before resending'))) {
            // Just in case resend path bubbles here
            showError('Please wait before resending the verification email.');
          } else if (error.message.includes('10 seconds')) {
            showError('Please wait 10 seconds before trying to register again.');
          } else {
            showError(error.message || 'Registration failed. Please try again.');
          }
        } finally {
          setFormEnabled(true);
        }
      }

      // Event Listeners
      const form = document.getElementById('register-form');
      if (form) {
        form.addEventListener('submit', handleRegistration);
      }

      // Close success message button
      const closeSuccessBtn = document.getElementById('close-success');
      if (closeSuccessBtn) {
        closeSuccessBtn.addEventListener('click', function () {
          const successEl = document.getElementById('register-success');
          if (successEl) {
            successEl.classList.add('hidden');
          }
        });
      }

      // Resend verification logic with cooldown UI
      function startOrUpdateResendCooldown(email) {
        const timerEl = document.getElementById('resend-timer');
        const btn = document.getElementById('resend-btn');
        if (!timerEl || !btn) return;
        function update() {
          const remaining = window.supabaseAuth.getVerificationCooldownRemaining(email);
          if (remaining > 0) {
            btn.disabled = true;
            timerEl.textContent = `You can resend in ${remaining}s`;
          } else {
            btn.disabled = false;
            timerEl.textContent = '';
          }
        }
        update();
        // Poll every second for a lightweight countdown
        if (window.__resendInterval) clearInterval(window.__resendInterval);
        window.__resendInterval = setInterval(update, 1000);
      }

      const resendBtn = document.getElementById('resend-btn');
      if (resendBtn) {
        resendBtn.addEventListener('click', async function () {
          const email = document.getElementById('reg-email').value.trim();
          if (!email) return;
          try {
            const redirectUrl = window.location.origin + '/index.html';
            const { error } = await window.supabaseAuth.resendVerificationEmail(email, redirectUrl);
            if (error && error.code === 'cooldown_active') {
              showError('Please wait before resending the verification email.');
            } else if (error) {
              showError(error.message || 'Failed to resend verification email.');
            } else {
              showSuccess('Verification email resent. Please check your inbox.', true);
              startOrUpdateResendCooldown(email);
            }
          } catch (err) {
            showError(err.message || 'Failed to resend verification email.');
          }
        });
      }

      // Real-time validation
      const emailInput = document.getElementById('reg-email');
      if (emailInput) {
        emailInput.addEventListener('blur', function () {
          const email = this.value.trim();
          if (email && !email.toLowerCase().endsWith('@umak.edu.ph')) {
            showError('Please use a University of Makati email address (@umak.edu.ph)');
          } else if (email) {
            hideAllMessages();
          }
        });
      }

      const passwordInput = document.getElementById('reg-pass');
      if (passwordInput) {
        passwordInput.addEventListener('input', function () {
          const password = this.value;
          if (password.length > 0 && password.length < 6) {
            showError('Password must be at least 6 characters long');
          } else if (password.length >= 6) {
            hideAllMessages();
          }
        });
      }

      const confirmPasswordInput = document.getElementById('reg-pass-confirm');
      if (confirmPasswordInput) {
        confirmPasswordInput.addEventListener('input', function () {
          const password = document.getElementById('reg-pass').value;
          const confirm = this.value;
          if (confirm.length > 0 && password !== confirm) {
            showError('Passwords do not match');
          } else if (confirm.length > 0 && password === confirm && password.length >= 6) {
            hideAllMessages();
          }
        });
      }

      // Mobile Menu Toggle
      (function () {
        const burgerBtn = document.getElementById('burgerMenuBtn');
        const mobileOverlay = document.getElementById('mobileMenuOverlay');
        const mobilePanel = document.getElementById('mobileMenuPanel');

        if (!burgerBtn || !mobileOverlay || !mobilePanel) return;

        let isMenuOpen = false;

        function openMenu() {
          isMenuOpen = true;

          // Calculate scrollbar width to prevent layout shift
          const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;

          // Store current scroll position
          const scrollY = window.scrollY;

          // Add classes and prevent scroll
          burgerBtn.classList.add('active');
          mobileOverlay.classList.add('active');
          mobilePanel.classList.add('active');

          // Prevent scroll without layout shift
          document.body.style.overflow = 'hidden';
          document.body.style.position = 'fixed';
          document.body.style.top = `-${scrollY}px`;
          document.body.style.width = '100%';

          // Compensate for scrollbar width if needed
          if (scrollbarWidth > 0) {
            document.body.style.paddingRight = `${scrollbarWidth}px`;
          }
        }

        function closeMenu() {
          isMenuOpen = false;

          // Get scroll position from body top
          const scrollY = document.body.style.top;

          // Remove classes
          burgerBtn.classList.remove('active');
          mobileOverlay.classList.remove('active');
          mobilePanel.classList.remove('active');

          // Restore scroll
          document.body.style.overflow = '';
          document.body.style.position = '';
          document.body.style.top = '';
          document.body.style.width = '';
          document.body.style.paddingRight = '';

          // Restore scroll position
          if (scrollY) {
            window.scrollTo(0, parseInt(scrollY || '0') * -1);
          }
        }

        function toggleMenu() {
          if (isMenuOpen) {
            closeMenu();
          } else {
            openMenu();
          }
        }

        burgerBtn.addEventListener('click', toggleMenu);
        mobileOverlay.addEventListener('click', closeMenu);

        const mobileNavItems = mobilePanel.querySelectorAll('.mobile-nav-item');
        mobileNavItems.forEach(item => {
          item.addEventListener('click', closeMenu);
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && isMenuOpen) {
            closeMenu();
          }
        });

        window.addEventListener('resize', () => {
          if (window.innerWidth > 768 && isMenuOpen) {
            closeMenu();
          }
        });

        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      })();

    })();
  </script>
  <script>
    // Library-themed cursor follower
    (function () {
      const follower = document.getElementById('cursor-follower');
      if (!follower) return;

      // Hide on touch devices
      const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
      if (isTouch) { follower.style.display = 'none'; return; }
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        follower.style.display = 'none'; return;
      }

      let mouseX = window.innerWidth / 2;
      let mouseY = window.innerHeight / 2;
      let posX = mouseX;
      let posY = mouseY;
      const ease = 0.08; // Slower, more gentle movement for library theme
      let isVisible = false;

      // Gentle fade in/out on mouse movement
      window.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        if (!isVisible) {
          follower.style.opacity = '0.6';
          isVisible = true;
        }
      }, { passive: true });

      // Fade out when mouse leaves window
      window.addEventListener('mouseleave', () => {
        follower.style.opacity = '0';
        isVisible = false;
      });

      // Smooth following animation
      function animate() {
        posX += (mouseX - posX) * ease;
        posY += (mouseY - posY) * ease;
        follower.style.transform = `translate(${posX}px, ${posY}px) translate(-50%, -50%)`;
        requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
    })();

    // Collapsible Header Toggle (Desktop Only)
    (function () {
      const trigger = document.getElementById('headerTrigger');
      const headerNav = document.getElementById('headerNav');

      if (!trigger || !headerNav) return;

      let isExpanded = false;
      let isInitialized = false;

      function init() {
        const isMobile = window.innerWidth <= 768;

        if (isMobile) {
          trigger.style.display = 'none';
          headerNav.classList.remove('header-collapsed');
          headerNav.classList.add('header-expanded');
          trigger.classList.remove('trigger-collapsed', 'trigger-expanded');
        } else {
          trigger.style.display = 'flex';
          if (!isInitialized) {
            headerNav.classList.add('header-collapsed');
            headerNav.classList.remove('header-expanded');
            trigger.classList.add('trigger-collapsed');
            trigger.classList.remove('trigger-expanded', 'header-expanded');
            isExpanded = false;
          }
        }

        isInitialized = true;
      }

      function toggleHeader(e) {
        if (e) e.stopPropagation();

        isExpanded = !isExpanded;

        requestAnimationFrame(() => {
          if (isExpanded) {
            headerNav.classList.add('animating-in');
            headerNav.classList.remove('header-collapsed');
            headerNav.classList.add('header-expanded');
            trigger.classList.remove('trigger-collapsed');
            trigger.classList.add('trigger-expanded', 'header-expanded');

            setTimeout(() => {
              headerNav.classList.remove('animating-in');
            }, 500);
          } else {
            headerNav.classList.add('animating-out');
            headerNav.classList.add('header-collapsed');
            headerNav.classList.remove('header-expanded');
            trigger.classList.remove('trigger-expanded', 'header-expanded');
            trigger.classList.add('trigger-collapsed');

            setTimeout(() => {
              headerNav.classList.remove('animating-out');
            }, 500);
          }
        });
      }

      init();
      trigger.addEventListener('click', toggleHeader);

      let clickTimeout;
      document.addEventListener('click', function (e) {
        if (isExpanded &&
          !headerNav.contains(e.target) &&
          !trigger.contains(e.target)) {
          clearTimeout(clickTimeout);
          clickTimeout = setTimeout(() => {
            if (isExpanded) toggleHeader();
          }, 100);
        }
      });

      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && isExpanded) {
          toggleHeader();
        }
      });

      let resizeTimeout;
      window.addEventListener('resize', function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          init();
        }, 150);
      });
    })();

    // Nav Label Hover Functionality
    (function () {
      const navLabel = document.getElementById('navLabel');
      const navItems = document.querySelectorAll('.sidebar-nav-item');

      if (!navLabel || !navItems.length) return;

      navItems.forEach(item => {
        const label = item.getAttribute('data-label');
        if (!label) return;

        item.addEventListener('mouseenter', function () {
          navLabel.textContent = label;
          navLabel.classList.add('visible');
        });

        item.addEventListener('mouseleave', function () {
          navLabel.classList.remove('visible');
        });
      });
    })();
  </script>
</body>

</html>